{
  "version": "2.5.0",
  "summary": {
    "title": "Continue threat models",
    "owner": "Trinh Xuan Khanh",
    "description": "",
    "id": 0
  },
  "detail": {
    "contributors": [],
    "diagrams": [
      {
        "id": 0,
        "title": "PATH TRAVERSAL Attack Threat Model",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": [
          {
            "position": {
              "x": 1614.9999999999995,
              "y": 210
            },
            "size": {
              "width": 330,
              "height": 50
            },
            "attrs": {
              "label": {
                "text": "Intended Directory (instance/statements/)"
              }
            },
            "visible": true,
            "shape": "trust-boundary-box",
            "id": "0b655cbc-2753-4e83-a710-5bb64f76e4ea",
            "zIndex": -1,
            "data": {
              "type": "tm.BoundaryBox",
              "name": "Intended Directory (instance/statements/)",
              "description": "Allowed directory for user file downloads",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 791.2499999999995,
              "y": -94.99999999999852
            },
            "size": {
              "width": 770,
              "height": 620
            },
            "attrs": {
              "label": {
                "text": "Application Trust Boundary"
              }
            },
            "visible": true,
            "shape": "trust-boundary-box",
            "id": "4690ad5b-c789-4810-a631-7ed5baeda7a1",
            "zIndex": -1,
            "data": {
              "type": "tm.BoundaryBox",
              "name": "Application Trust Boundary",
              "description": "Protected areas: app/, config files, system files",
              "isTrustBoundary": true,
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 590,
              "y": -80
            },
            "size": {
              "width": 112.5,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "Attacker"
              },
              "body": {
                "stroke": "#333333",
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "actor",
            "zIndex": 1,
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "414f157c-ccc5-470e-bebf-21bdb9826f5a"
                },
                {
                  "group": "right",
                  "id": "545d63d4-cb6c-4a73-82fb-d0df7abfa442"
                },
                {
                  "group": "bottom",
                  "id": "6568a069-fda0-43af-ad68-523780faa50e"
                },
                {
                  "group": "left",
                  "id": "9d3ddd07-1c69-412b-b287-2b0f45c9ff6f"
                }
              ]
            },
            "id": "836ccc15-4637-4bcf-b3f5-ce79433d6ee7",
            "data": {
              "type": "tm.Actor",
              "name": "Attacker",
              "description": "Authenticated malicious user exploiting download endpoint",
              "isTrustBoundary": false,
              "outOfScope": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "providesAuthentication": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 870,
              "y": -10
            },
            "size": {
              "width": 370,
              "height": 380
            },
            "attrs": {
              "text": {
                "text": "Flask Web Application - Download Route"
              },
              "body": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "process",
            "zIndex": 2,
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "1d36fe06-83f8-4c97-929c-39e5d0008de0"
                },
                {
                  "group": "right",
                  "id": "c7bfda54-63a0-4fd9-83c0-d1ead200b808"
                },
                {
                  "group": "bottom",
                  "id": "4efe62fe-208b-4282-93dd-71c21f379ed2"
                },
                {
                  "group": "left",
                  "id": "a702111b-98c4-4716-87a4-2563fc399433"
                }
              ]
            },
            "id": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
            "data": {
              "type": "tm.Process",
              "name": "Flask Web Application - Download Route",
              "description": "Description: \"/download endpoint (GET)\"\nPrivilege Level: \"High\"\nVulnerable Code: os.path.join(instance_path, filename)",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "handlesCardPayment": false,
              "handlesGoodsOrServices": false,
              "isWebApplication": false,
              "privilegeLevel": "",
              "threats": [
                {
                  "id": "4bdd71ec-6d76-4501-9dbf-9527f70970ce",
                  "title": "Insecure File Download Implementation",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "The /download endpoint implements file downloads without proper \npath validation, directory restrictions, or access controls.\n\nVulnerabilities:\n1. No path normalization\n2. No whitelist validation\n3. No absolute path verification\n4. No file extension checking\n5. No access control verification\n\nAttack Surface:\n- Any authenticated user can exploit\n- No rate limiting on download endpoint\n- Error messages may leak directory structure\n\nBusiness Impact:\n- Loss of intellectual property (source code)\n- Credential compromise\n- Compliance violations (data breach)\n- Potential for complete system compromise",
                  "mitigation": "1. Implement secure path handling (use safe_join)\n2. Whitelist allowed files or patterns\n3. Add access control checks\n4. Log all download attempts\n5. Implement rate limiting\n6. Use indirect reference map (filename ‚Üí UUID mapping)",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 3,
                  "score": "7.5"
                }
              ],
              "threatFrequency": {
                "spoofing": 0,
                "tampering": 0,
                "repudiation": 0,
                "informationDisclosure": 1,
                "denialOfService": 0,
                "elevationOfPrivilege": 0
              }
            }
          },
          {
            "position": {
              "x": 1619.9999999999995,
              "y": 75
            },
            "size": {
              "width": 320,
              "height": 210
            },
            "attrs": {
              "text": {
                "text": "File System"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "zIndex": 3,
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "905000c0-3ce1-45fe-a0a6-e60b4e441fa3"
                },
                {
                  "group": "right",
                  "id": "1e90f9be-9d88-4583-bd3a-8cddce4a4df1"
                },
                {
                  "group": "bottom",
                  "id": "a9e910be-2b1b-4fbb-9cc6-ec79a7f8474a"
                },
                {
                  "group": "left",
                  "id": "27b1bcde-1480-499a-ae7a-58eca726c858"
                }
              ]
            },
            "id": "baf8564d-7799-4ed5-9dab-7dc842f0aef2",
            "data": {
              "type": "tm.Store",
              "name": "File System",
              "description": "Contains app files, config files, system files",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": false,
              "storesInventory": false,
              "threats": []
            }
          },
          {
            "position": {
              "x": 586.25,
              "y": 245
            },
            "size": {
              "width": 120,
              "height": 60
            },
            "attrs": {
              "text": {
                "text": "SQLite Database"
              },
              "topLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              },
              "bottomLine": {
                "strokeWidth": 1.5,
                "strokeDasharray": null
              }
            },
            "visible": true,
            "shape": "store",
            "ports": {
              "groups": {
                "top": {
                  "position": "top",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "right": {
                  "position": "right",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "bottom": {
                  "position": "bottom",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                },
                "left": {
                  "position": "left",
                  "attrs": {
                    "circle": {
                      "r": 4,
                      "magnet": true,
                      "stroke": "#5F95FF",
                      "strokeWidth": 1,
                      "fill": "#fff",
                      "style": {
                        "visibility": "hidden"
                      }
                    }
                  }
                }
              },
              "items": [
                {
                  "group": "top",
                  "id": "dcc75be5-ab6d-47a5-b839-07296b50731a"
                },
                {
                  "group": "right",
                  "id": "3a08cfcf-33ff-435f-b4a2-83c2e08946e0"
                },
                {
                  "group": "bottom",
                  "id": "5d166603-aec6-40c8-9a08-d3440afb30b1"
                },
                {
                  "group": "left",
                  "id": "76f8fc6b-4885-43c9-941d-8a57e9603f1c"
                }
              ]
            },
            "id": "b487134d-f2df-4058-b8e1-04488737bc53",
            "zIndex": 4,
            "data": {
              "type": "tm.Store",
              "name": "SQLite Database",
              "description": "Target for credential escalation",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isALog": false,
              "isEncrypted": false,
              "isSigned": false,
              "storesCredentials": false,
              "storesInventory": false,
              "threats": []
            }
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Vulnerable Path Construction",
              "description": "Data: \"os.path.join(instance_path, '../app/schema.sql')\"\n  Description: \"Path constructed without validation\"\n  \n  Vulnerable Code:\n  filepath = os.path.join(app.instance_path, filename)\n  # Result: instance/../app/schema.sql ‚Üí app/schema.sql\n  \n  ‚ö†Ô∏è NO VALIDATION:\n  - No path normalization\n  - No whitelist check\n  - No absolute path verification",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Vulnerable Path Construction"
            ],
            "id": "4bbb6445-d945-4c45-9e52-1018f5862b1a",
            "source": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "4efe62fe-208b-4282-93dd-71c21f379ed2"
            },
            "target": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "4efe62fe-208b-4282-93dd-71c21f379ed2"
            },
            "vertices": [
              {
                "x": 990,
                "y": 470
              },
              {
                "x": 1120,
                "y": 470
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "File System Access (Unauthorized)",
              "description": "Protocol: File I/O\n  Data: \"Read request for app/schema.sql\"\n  Description: \"Application reads file outside intended directory\"\n  \n  Accessed Files:\n  - app/schema.sql (database structure)\n  - app/auth.py (source code)\n  - app/__init__.py (config with credentials)",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "394c7d45-4a6c-4782-be60-5a46c028072e",
                  "title": "Unauthorized File System Access",
                  "status": "Open",
                  "severity": "Critical",
                  "type": "Information disclosure",
                  "description": "Application accesses files outside the intended directory due to \nlack of path validation, allowing authenticated users to read \narbitrary files within application's file system permissions.\n\nTechnical Details:\nVulnerable Code:\n@app.route('/download')\ndef download():\n    filename = request.args.get('file')\n    filepath = os.path.join(app.instance_path, filename)  # VULNERABLE!\n    return send_file(filepath, as_attachment=True)\n\nProblem:\nos.path.join() does NOT prevent path traversal:\n- os.path.join('/instance', '../app/file.py') ‚Üí '/app/file.py'\n- Absolute paths in second argument override first argument\n- No validation of final resolved path\n\nExploitation:\n1. Normal use: /download?file=statement.pdf ‚Üí instance/statements/statement.pdf ‚úÖ\n2. Attack: /download?file=../app/schema.sql ‚Üí app/schema.sql üî¥",
                  "mitigation": "Use secure path handling:\nfrom werkzeug.security import safe_join\n\n@app.route('/download')\ndef download():\n    filename = request.args.get('file')\n    safe_path = safe_join(app.instance_path, filename)\n    if safe_path is None:\n        abort(400, \"Invalid file path\")\n    return send_file(safe_path, as_attachment=True)",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 2,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 0,
                "informationDisclosure": 1,
                "denialOfService": 0
              }
            },
            "labels": [
              "File System Access (Unauthorized)"
            ],
            "id": "08658393-9956-430b-9a93-e3385d1f88cc",
            "source": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "c7bfda54-63a0-4fd9-83c0-d1ead200b808"
            },
            "target": {
              "cell": "baf8564d-7799-4ed5-9dab-7dc842f0aef2",
              "port": "27b1bcde-1480-499a-ae7a-58eca726c858"
            },
            "vertices": [
              {
                "x": 1420,
                "y": 110
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Sensitive File Content",
              "description": "Data: \"Database schema, source code, configuration\"\n  Description: \"File system returns unauthorized file content\"\n  \n  Exposed Information:\n  - Database structure and relationships\n  - Application source code\n  - Database credentials\n  - API keys and secrets\n  - System configuration",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Sensitive File Content"
            ],
            "id": "ba57f287-d0bd-4cce-b6a3-4697e3de6af3",
            "source": {
              "cell": "baf8564d-7799-4ed5-9dab-7dc842f0aef2",
              "port": "27b1bcde-1480-499a-ae7a-58eca726c858"
            },
            "target": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "c7bfda54-63a0-4fd9-83c0-d1ead200b808"
            },
            "vertices": [
              {
                "x": 1430,
                "y": 260
              }
            ]
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP Response (File Download)",
              "description": "Protocol: HTTP\n  Data: \"Sensitive file content as download\"\n  Content-Type: \"application/octet-stream\"\n  Description: \"Attacker receives unauthorized file\"",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "HTTP Response (File Download)"
            ],
            "id": "47334909-e3df-455f-86bb-7f872270ce92",
            "source": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "a702111b-98c4-4716-87a4-2563fc399433"
            },
            "target": {
              "cell": "836ccc15-4637-4bcf-b3f5-ce79433d6ee7",
              "port": "6568a069-fda0-43af-ad68-523780faa50e"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "#333333",
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "Direct Database Access (Escalation)",
              "description": "Protocol: SQLite\n  Data: \"Direct connection using stolen credentials\"\n  Description: \"Attacker bypasses application and accesses DB directly\"\n  Impact: \"Full data exfiltration\"",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": false,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": []
            },
            "labels": [
              "Direct Database Access (Escalation)"
            ],
            "id": "956db8e3-3543-4d17-a8c8-ec6ac07a7591",
            "source": {
              "cell": "836ccc15-4637-4bcf-b3f5-ce79433d6ee7",
              "port": "6568a069-fda0-43af-ad68-523780faa50e"
            },
            "target": {
              "cell": "b487134d-f2df-4058-b8e1-04488737bc53",
              "port": "dcc75be5-ab6d-47a5-b839-07296b50731a"
            },
            "vertices": []
          },
          {
            "shape": "flow",
            "attrs": {
              "line": {
                "stroke": "red",
                "strokeWidth": 2.5,
                "targetMarker": {
                  "name": "block"
                },
                "sourceMarker": {
                  "name": ""
                },
                "strokeDasharray": null
              }
            },
            "width": 200,
            "height": 100,
            "zIndex": 10,
            "connector": "smooth",
            "data": {
              "type": "tm.Flow",
              "name": "HTTP GET (Path Traversal)",
              "description": "Protocol: HTTP\n  Data: \"file=../app/schema.sql\"\n  URL: \"http://localhost:5000/download?file=../app/schema.sql\"\n  Description: \"Attacker sends request with path traversal payload\"\n  \n  Attack Payload Examples:\n  - ../app/schema.sql\n  - ../app/auth.py\n  - ../app/__init__.py\n  - ../../etc/passwd\n  - ../../../windows/system32/config/sam",
              "outOfScope": false,
              "isTrustBoundary": false,
              "reasonOutOfScope": "",
              "hasOpenThreats": true,
              "isBidirectional": false,
              "isEncrypted": false,
              "isPublicNetwork": false,
              "protocol": "",
              "threats": [
                {
                  "id": "a1fa21a5-3a7e-4f82-8aba-8aed231479b2",
                  "title": "Path Traversal via File Parameter",
                  "status": "Open",
                  "severity": "High",
                  "type": "Information disclosure",
                  "description": "Attacker manipulates the 'file' query parameter with path traversal \nsequences (../) to escape the intended directory (instance/statements/) \nand access sensitive files including source code, configuration files, \nand system files.\n\nAttack Vector:\nGET /download?file=../app/schema.sql\nGET /download?file=../app/__init__.py\nGET /download?file=../../etc/passwd\n\nImpact:\n- Exposure of database schema\n- Source code disclosure\n- Credential theft (DB passwords, API keys)\n- System file access\n- Potential for privilege escalation\n\nAffected Asset:\n- Flask Download Route (/download endpoint)\n- File System (app/, config/, system directories)",
                  "mitigation": "1. Path Normalization:\n   - Use os.path.realpath() to resolve paths\n   - Check if resolved path starts with allowed directory\n   \n2. Whitelist Validation:\n   - Maintain list of allowed filenames\n   - Only serve files from whitelist\n   \n3. Absolute Path Checking:\n   allowed_dir = os.path.realpath(app.instance_path)\n   file_path = os.path.realpath(os.path.join(allowed_dir, filename))\n   if not file_path.startswith(allowed_dir):\n       abort(403)\n   \n4. Input Sanitization:\n   - Remove or reject ../ sequences\n   - Validate filename format\n   \n5. Principle of Least Privilege:\n   - Run application with minimal file system permissions",
                  "modelType": "STRIDE",
                  "new": false,
                  "number": 1,
                  "score": ""
                }
              ],
              "threatFrequency": {
                "tampering": 0,
                "informationDisclosure": 1,
                "denialOfService": 0
              }
            },
            "labels": [
              "HTTP GET (Path Traversal)"
            ],
            "id": "3c13fb33-3b7d-45f8-9c70-22b20acfc851",
            "source": {
              "cell": "836ccc15-4637-4bcf-b3f5-ce79433d6ee7",
              "port": "545d63d4-cb6c-4a73-82fb-d0df7abfa442"
            },
            "target": {
              "cell": "cc0e8317-af85-4e1e-843a-fd245ad7434f",
              "port": "1d36fe06-83f8-4c97-929c-39e5d0008de0"
            },
            "vertices": []
          },
          {
            "position": {
              "x": 531.25,
              "y": -160
            },
            "size": {
              "width": 230,
              "height": 80
            },
            "attrs": {
              "text": {
                "text": "üìù Attacker extracts:\n  - DB credentials from __init__.py\n  - API keys from config files\n  - User data structure from schema.sql"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "4eb3c093-72eb-4b2c-9a34-37c4c209b13c",
            "zIndex": 11,
            "data": {
              "type": "tm.Text",
              "name": "üìù Attacker extracts:\n  - DB credentials from __init__.py\n  - API keys from config files\n  - User data structure from schema.sql",
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 835,
              "y": -255
            },
            "size": {
              "width": 440,
              "height": 160
            },
            "attrs": {
              "text": {
                "text": "üéØ PATH TRAVERSAL ATTACK FLOW:\n\n1. Attacker: GET /download?file=../app/schema.sql\n2. Flask: filepath = join(instance_path, '../app/schema.sql')\n3. Result: instance/../app/schema.sql ‚Üí app/schema.sql\n4. Flask: send_file('app/schema.sql')  ‚Üê Escapes intended directory!\n5. Attacker: Downloads sensitive file\n6. Attacker: Extracts credentials\n7. Attacker: Direct database access"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "c1d0e595-648f-4a80-a05c-517b91f6a9fe",
            "zIndex": 12,
            "data": {
              "type": "tm.Text",
              "name": "üéØ PATH TRAVERSAL ATTACK FLOW:\n\n1. Attacker: GET /download?file=../app/schema.sql\n2. Flask: filepath = join(instance_path, '../app/schema.sql')\n3. Result: instance/../app/schema.sql ‚Üí app/schema.sql\n4. Flask: send_file('app/schema.sql')  ‚Üê Escapes intended directory!\n5. Attacker: Downloads sensitive file\n6. Attacker: Extracts credentials\n7. Attacker: Direct database access",
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 1960,
              "y": 55
            },
            "size": {
              "width": 260,
              "height": 250
            },
            "attrs": {
              "text": {
                "text": "üìÅ FILE SYSTEM STRUCTURE:\n\n‚úÖ INTENDED (Allowed):\n   /instance/statements/*.pdf\n\nüî¥ RESTRICTED (Should be blocked):\n   /app/*.py (source code)\n   /app/*.sql (schema)\n   /config/*.ini (credentials)\n   /../ (parent directories)\n   /etc/* (system files)\n\n‚ö†Ô∏è VULNERABLE PATH:\n   /download?file=../app/schema.sql\n   ‚Üí Escapes /instance/statements/\n   ‚Üí Accesses /app/schema.sql"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "c1a0c0c4-3983-45f0-be14-e5d43c75cdb0",
            "zIndex": 13,
            "data": {
              "type": "tm.Text",
              "name": "üìÅ FILE SYSTEM STRUCTURE:\n\n‚úÖ INTENDED (Allowed):\n   /instance/statements/*.pdf\n\nüî¥ RESTRICTED (Should be blocked):\n   /app/*.py (source code)\n   /app/*.sql (schema)\n   /config/*.ini (credentials)\n   /../ (parent directories)\n   /etc/* (system files)\n\n‚ö†Ô∏è VULNERABLE PATH:\n   /download?file=../app/schema.sql\n   ‚Üí Escapes /instance/statements/\n   ‚Üí Accesses /app/schema.sql",
              "hasOpenThreats": false
            }
          },
          {
            "position": {
              "x": 1619.9999999999995,
              "y": -170
            },
            "size": {
              "width": 430,
              "height": 200
            },
            "attrs": {
              "text": {
                "text": "‚ö†Ô∏è CRITICAL VULNERABILITY\n\nImpact: HIGH\nExploitability: EASY (just modify URL parameter)\nDetection: LOW (looks like normal file access)\n\nExposed Files:\n- app/schema.sql ‚Üí Database structure\n- app/__init__.py ‚Üí DB credentials\n- app/auth.py ‚Üí Authentication logic\n- ../etc/passwd ‚Üí System users (Linux)\n\nEscalation Path:\nFile Access ‚Üí Credentials ‚Üí Direct DB Access ‚Üí Full Data Breach"
              }
            },
            "visible": true,
            "shape": "td-text-block",
            "id": "c11ab290-a931-4353-a39e-2f0d21fb2a46",
            "zIndex": 14,
            "data": {
              "type": "tm.Text",
              "name": "‚ö†Ô∏è CRITICAL VULNERABILITY\n\nImpact: HIGH\nExploitability: EASY (just modify URL parameter)\nDetection: LOW (looks like normal file access)\n\nExposed Files:\n- app/schema.sql ‚Üí Database structure\n- app/__init__.py ‚Üí DB credentials\n- app/auth.py ‚Üí Authentication logic\n- ../etc/passwd ‚Üí System users (Linux)\n\nEscalation Path:\nFile Access ‚Üí Credentials ‚Üí Direct DB Access ‚Üí Full Data Breach",
              "hasOpenThreats": false
            }
          }
        ]
      },
      {
        "id": 1,
        "title": "INSECURE DIRECT OBJECT REFERENCE (IDOR) Attack Threat Model",
        "diagramType": "STRIDE",
        "placeholder": "New STRIDE diagram description",
        "thumbnail": "./public/content/images/thumbnail.stride.jpg",
        "version": "2.5.0",
        "cells": []
      }
    ],
    "diagramTop": 2,
    "reviewer": "",
    "threatTop": 3
  }
}